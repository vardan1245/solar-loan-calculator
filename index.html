<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Loan Calculator</title>
    <link rel="icon" type="image/x-icon" href="tIAMAT white blue-06.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="config.js"></script>
    <style>
        .spoiler {
            cursor: pointer;
            user-select: none;
            background: linear-gradient(45deg, #333 25%, transparent 25%), 
                        linear-gradient(-45deg, #333 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #333 75%), 
                        linear-gradient(-45deg, transparent 75%, #333 75%);
            background-size: 4px 4px;
            background-position: 0 0, 0 2px, 2px -2px, -2px 0px;
            color: transparent;
            transition: all 0.3s ease;
        }
        
        .spoiler:hover {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .spoiler-revealed {
            cursor: pointer;
            background: #f3f4f6;
            color: inherit;
            transition: all 0.3s ease;
        }
        
        .spoiler-revealed:hover {
            background: #e5e7eb;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tiamat-blue': '#0066CC',
                        'tiamat-light-blue': '#4A90E2',
                        'tiamat-dark-blue': '#004499',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 space-y-6">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
                <img src="tIAMAT white blue-06.ico" alt="Tiamat Logo" class="h-8 w-8">
                <h1 class="text-3xl font-bold text-tiamat-blue" data-en="Solar Loan Calculator" data-hy="Արևային կայանի վարկի հաշվիչ">Solar Loan Calculator</h1>
            </div>
            
            <!-- Language Switcher -->
            <div class="flex items-center gap-2">
                <button onclick="switchLanguage('en')" id="langEn" class="px-3 py-1 rounded-md text-sm font-medium bg-tiamat-blue text-white">EN</button>
                <button onclick="switchLanguage('hy')" id="langHy" class="px-3 py-1 rounded-md text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">ՀԱՅ</button>
                
                <!-- Admin Login Button (Hidden) -->
                <button id="adminLoginBtn" onclick="showAdminLogin()" 
                        class="px-3 py-1 rounded-md text-sm font-medium bg-gray-500 text-white hover:bg-gray-600 transition-colors hidden">
                    <span data-en="Admin" data-hy="Ադմին">Admin</span>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Input Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4" data-en="System Configuration" data-hy="Համակարգի կարգավորում">System Configuration</h2>
                

                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-en="System Power (kW)" data-hy="Համակարգի հզորություն (կՎտ)">System Power (kW)</label>
                        <input type="number" id="systemPower" data-en-placeholder="Enter system power" data-hy-placeholder="Մուտքագրեք համակարգի հզորությունը" placeholder="Enter system power" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Installation Type" data-hy="Տեղադրման տեսակը">Installation Type</label>
                        <select id="installationType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                            <option value="onRoof" data-en="On Roof" data-hy="Տանիքի վրա (լանջային)">On Roof</option>
                            <option value="metalConstructionOnRoof" data-en="Metal Construction on Roof" data-hy="Մետաղական կոնստրուկցիա տանիքի վրա">Metal Construction on Roof</option>
                            <option value="aluminiumConstructionOnRoof" data-en="Aluminium Construction on Roof" data-hy="Ալյումինե կոնստրուկցիա տանիքի վրա">Aluminium Construction on Roof</option>
                            <option value="systemOnGround" data-en="System on Ground" data-hy="Համակարգ գետնի վրա">System on Ground</option>
                        </select>
                    </div>

                                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Inverter Model" data-hy="Ինվերտորի մոդել">Inverter Model</label>
                    <select id="inverterSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="auto" data-en="Auto Select (Recommended)" data-hy="Ավտոմատ ընտրություն (Խորհուրդ է տրվում)">Auto Select (Recommended)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Warranty Years" data-hy="Երաշխիքային տարիներ">Warranty Years</label>
                    <select id="warrantyYears" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="2" data-en="2 Years" data-hy="2 Տարի">2 Years</option>
                        <option value="3" data-en="3 Years" data-hy="3 Տարի">3 Years</option>
                        <option value="6" data-en="6 Years" data-hy="6 Տարի">6 Years</option>
                        <option value="12" data-en="12 Years" data-hy="12 Տարի">12 Years</option>
                    </select>
                </div>

                    <button onclick="calculateLoan()" 
                            class="w-full bg-tiamat-blue hover:bg-tiamat-dark-blue text-white font-semibold py-2 px-4 rounded-md transition-colors"
                            data-en="Calculate Loan Options" data-hy="Հաշվարկել վարկի տարբերակները">
                        Calculate Loan Options
                    </button>
                </div>
            </div>

            <!-- Results -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4" data-en="Calculation Results" data-hy="Հաշվարկի արդյունքները">Calculation Results</h2>
                
                <div id="results" class="space-y-4">
                    <div class="text-center text-gray-500" data-en="Enter system parameters and click 'Calculate Loan Options' to see results" data-hy="Մուտքագրեք համակարգի պարամետրերը և սեղմեք 'Հաշվարկել վարկի տարբերակները' արդյունքները տեսնելու համար">
                        Enter system parameters and click "Calculate Loan Options" to see results
                    </div>
                </div>
            </div>
        </div>

        <!-- Loan Options Table -->
        <div id="loanTable" class="bg-white rounded-lg shadow-md p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Available Loan Options</h2>
            
            <!-- Filters and Sorting -->
            <div class="mb-4 flex flex-wrap gap-4 items-center">
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700" data-en="Filter by Bank:" data-hy="Զտել ըստ բանկի:">Filter by Bank:</label>
                    <select id="bankFilter" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="" data-en="All Banks" data-hy="Բոլոր բանկերը">All Banks</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700" data-en="Filter by Period:" data-hy="Զտել ըստ ժամկետի:">Filter by Period:</label>
                    <select id="periodFilter" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="" data-en="All Periods" data-hy="Ամբողջը">All Periods</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700" data-en="Sort by:" data-hy="Դասավորել ըստ:">Sort by:</label>
                    <select id="sortBy" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="monthlyPayment" data-en="Monthly Payment (Low to High)" data-hy="Ամսական վճար (ցածրից բարձր)">Monthly Payment (Low to High)</option>
                        <option value="monthlyPaymentDesc" data-en="Monthly Payment (High to Low)" data-hy="Ամսական վճար (բարձրից ցածր)">Monthly Payment (High to Low)</option>
                        <option value="loanAmount" data-en="Loan Amount (Low to High)" data-hy="Վարկի գումար (ցածրից բարձր)">Loan Amount (Low to High)</option>
                        <option value="loanAmountDesc" data-en="Loan Amount (High to Low)" data-hy="Վարկի գումար (բարձրից ցածր)">Loan Amount (High to Low)</option>
                        <option value="totalAmount" data-en="Total Amount (Low to High)" data-hy="Ընդհանուր գումար (ցածրից բարձր)">Total Amount (Low to High)</option>
                        <option value="totalAmountDesc" data-en="Total Amount (High to Low)" data-hy="Ընդհանուր գումար (բարձրից ցածր)">Total Amount (High to Low)</option>
                        <option value="interestRate" data-en="Interest Rate (Low to High)" data-hy="Տոկոսադրույք (ցածրից բարձր)">Interest Rate (Low to High)</option>
                        <option value="interestRateDesc" data-en="Interest Rate (High to Low)" data-hy="Տոկոսադրույք (բարձրից ցածր)">Interest Rate (High to Low)</option>

                        <option value="loanPeriod" data-en="Loan Period (Low to High)" data-hy="Վարկի ժամկետ (ցածրից բարձր)">Loan Period (Low to High)</option>
                        <option value="loanPeriodDesc" data-en="Loan Period (High to Low)" data-hy="Վարկի ժամկետ (բարձրից ցածր)">Loan Period (High to Low)</option>
                    </select>
                </div>
                
                <button onclick="clearFilters()" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md text-sm transition-colors"
                        data-en="Clear Filters" data-hy="Մաքրել զտիչները">
                    Clear Filters
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border p-3 text-left font-medium cursor-pointer hover:bg-gray-100" onclick="sortTable('bankName')">
                                <span data-en="Bank" data-hy="Բանկ">Bank</span> <span id="bankSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-32 cursor-pointer hover:bg-gray-100" onclick="sortTable('loanPeriod')">
                                <span data-en="Loan Period" data-hy="Վարկի ժամկետ">Loan Period</span> <span id="periodSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-24 cursor-pointer hover:bg-gray-100" onclick="sortTable('interestRate')">
                                <span data-en="Interest Rate" data-hy="Տոկոսադրույք">Interest Rate</span> <span id="rateSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-24 cursor-pointer hover:bg-gray-100 admin-only" onclick="sortTable('commission')" style="display: none;">
                                <span data-en="Commission" data-hy="Կոմիսիա">Commission</span> <span id="commissionSortIcon" class="ml-1">↕</span>
                            </th>

                            <th class="border p-3 text-center font-medium w-40 cursor-pointer hover:bg-gray-100" onclick="sortTable('loanAmount')">
                                <span data-en="Loan Amount" data-hy="Վարկի գումար">Loan Amount</span> <span id="amountSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-36 cursor-pointer hover:bg-gray-100" onclick="sortTable('monthlyPayment')">
                                <span data-en="Monthly Payment" data-hy="Ամսական վճար">Monthly Payment</span> <span id="paymentSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-40 cursor-pointer hover:bg-gray-100" onclick="sortTable('totalInterest')">
                                <span data-en="Total Interest" data-hy="Ընդհանուր տոկոս">Total Interest</span> <span id="interestSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-44 cursor-pointer hover:bg-gray-100" onclick="sortTable('totalAmount')">
                                <span data-en="Total Amount" data-hy="Ընդհանուր գումար">Total Amount</span> <span id="totalSortIcon" class="ml-1">↕</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="loanTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4 text-sm text-gray-600">
                <span id="resultCount" data-en="Showing all results" data-hy="Ցուցադրվում են բոլոր արդյունքները">Showing all results</span>
            </div>
        </div>
    </div>

    <script>
        // Bank configurations
        const bankConfigurations = CONFIG.BANK_CONFIGURATIONS;

        function calculateLoanPayment(principal, annualRate, months) {
            const monthlyRate = annualRate / 12;
            if (monthlyRate === 0) return principal / months;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
        }

        // Inverter list (use upper price for duplicates)
        const inverters = CONFIG.INVERTERS;

        // New base prices per kW (without inverter)
        const basePrices = CONFIG.BASE_PRICES;

        function calculateLoan() {
            // Get input values
            const systemPower = parseFloat(document.getElementById('systemPower').value);
            const installationType = document.getElementById('installationType').value;

            if (!systemPower) {
                alert('Please enter system power');
                return;
            }

            // Get base price per kW (without inverter)
            let basePricePerKw = basePrices[installationType] || 130000;
            
            // Get warranty years and determine profit per kW
            const warrantyYears = parseInt(document.getElementById('warrantyYears').value) || 12;
            const profitPerKw = CONFIG.PROFIT_BY_WARRANTY[warrantyYears] || CONFIG.PROFIT_BY_WARRANTY[12];
            
            const basePrice = Math.ceil(systemPower * basePricePerKw);
            const profitAmount = Math.ceil(systemPower * profitPerKw);

            // Check if system is larger than 110 kW
            if (systemPower > 110) {
                const currentLanguage = localStorage.getItem('loanCalculatorLanguage') || 'en';
                const message = currentLanguage === 'en' 
                    ? 'System size exceeds 110 kW. Please contact upper management for pricing.'
                    : 'Համակարգի չափը գերազանցում է 110 կՎտ-ը: Խնդրում ենք կապ հաստատել վաճառքի բաժնի հետ գնագոյացման համար:';
                
                document.getElementById('results').innerHTML = `
                    <div class="space-y-3">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-yellow-800 font-medium">${message}</span>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            // Get selected inverter
            const selectedInverterKw = document.getElementById('inverterSelect').value;
            let selectedInverter = null;
            
            if (selectedInverterKw === 'auto') {
                // Auto select: smallest inverter where inverter.kw * 1.15 >= systemPower
                for (let i = 0; i < inverters.length; i++) {
                    if (inverters[i].kw * 1.15 >= systemPower) {
                        selectedInverter = inverters[i];
                        break;
                    }
                }
                if (!selectedInverter) {
                    alert('No suitable inverter found for this system size!');
                    return;
                }
            } else {
                // Manual selection
                selectedInverter = inverters.find(inv => inv.kw == selectedInverterKw);
                if (!selectedInverter) {
                    alert('Selected inverter not found!');
                    return;
                }
            }
            
            const inverterPrice = selectedInverter.price;
            const inverterKw = selectedInverter.kw;

            // Calculate total system price including sales team and unexpected expenses
            const salesTeamPct = CONFIG.PERCENTAGES.salesTeam; // 6%
            const unanticipatedExpensesPct = CONFIG.PERCENTAGES.unexpectedExpenses; // 2%
            
            // Total system price including sales team and unexpected expenses
            const totalSystemPrice = Math.ceil((basePrice + profitAmount + inverterPrice) / (1 - salesTeamPct - unanticipatedExpensesPct));

            // Display results
            const currentLanguage = localStorage.getItem('loanCalculatorLanguage') || 'en';
            const systemValueText = currentLanguage === 'en' ? 'System Value for Cash:' : 'Կանխիկ վաճառքի գին:';
            const breakdownTitle = currentLanguage === 'en' ? 'Calculation Breakdown:' : 'Հաշվարկի մանրամասները:';
            const basePriceText = currentLanguage === 'en' ? 'Base Price (no inverter):' : 'Բազային գին (առանց ինվերտորի):';
            const profitText = currentLanguage === 'en' ? `Profit (${profitPerKw.toLocaleString()} per kW):` : `Շահույթ (${profitPerKw.toLocaleString()} կՎտ-ի համար):`;
            const inverterPriceText = currentLanguage === 'en' ? 'Inverter Price:' : 'Ինվերտորի գին:';
            const subtotalText = currentLanguage === 'en' ? 'Subtotal (Base + Profit + Inverter):' : 'Ենթագումար (Բազային + Շահույթ + Ինվերտոր):';
            const salesTeamText = currentLanguage === 'en' ? 'Sales Team (6%):' : 'Վաճառքի թիմ (6%):';
            const unexpectedExpensesText = currentLanguage === 'en' ? 'Unexpected Expenses (2%):' : 'Անսպասելի ծախսեր (2%):';
            
            const basePriceWithProfitAndInverter = basePrice + profitAmount + inverterPrice;
            const salesTeamAmount = Math.ceil(totalSystemPrice * salesTeamPct);
            const unexpectedExpensesAmount = Math.ceil(totalSystemPrice * unanticipatedExpensesPct);
            
            const selectedInverterText = currentLanguage === 'en' ? 'Selected Inverter:' : 'Ընտրված ինվերտոր:';
            
            // Show detailed breakdown for admin, simple view for regular users
            if (isAdminLoggedIn) {
                // Calculate percentages for display
                const basePricePct = ((basePrice / totalSystemPrice) * 100).toFixed(1);
                const profitPct = ((profitAmount / totalSystemPrice) * 100).toFixed(1);
                const inverterPct = ((inverterPrice / totalSystemPrice) * 100).toFixed(1);
                const salesTeamPctDisplay = (salesTeamPct * 100).toFixed(1);
                const unexpectedExpensesPctDisplay = (unanticipatedExpensesPct * 100).toFixed(1);
                
                // Get installation type name for display
                const installationTypeNames = {
                    'aluminiumConstructionOnRoof': currentLanguage === 'en' ? 'Aluminium Construction on Roof' : 'Ալյումինե կոնստրուկցիա տանիքի վրա',
                    'metalConstructionOnRoof': currentLanguage === 'en' ? 'Metal Construction on Roof' : 'Մետաղական կոնստրուկցիա տանիքի վրա',
                    'onRoof': currentLanguage === 'en' ? 'On Roof (Sloped)' : 'Տանիքի վրա (լանջային)',
                    'systemOnGround': currentLanguage === 'en' ? 'System on Ground' : 'Համակարգ գետնի վրա'
                };
                const installationTypeName = installationTypeNames[installationType] || installationType;
                
                document.getElementById('results').innerHTML = `
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="font-medium text-lg">${systemValueText}</span>
                            <span class="text-green-600 font-semibold text-lg">${totalSystemPrice.toLocaleString()} AMD</span>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-md space-y-4">
                            <h4 class="font-semibold text-gray-800 border-b pb-2">${breakdownTitle}</h4>
                            
                            <!-- Step 1: Base Price -->
                            <div class="space-y-2">
                                <div class="text-sm font-medium text-gray-700">Step 1: Base Price Calculation</div>
                                <div class="pl-4 space-y-1 text-sm">
                                    <div class="flex justify-between">
                                        <span>Installation Type:</span>
                                        <span>${installationTypeName}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Base Price per kW:</span>
                                        <span class="font-mono">${basePricePerKw.toLocaleString()} AMD</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>System Power:</span>
                                        <span>${systemPower} kW</span>
                                    </div>
                                    <div class="flex justify-between font-medium">
                                        <span>Base Price:</span>
                                        <span class="font-mono">${basePrice.toLocaleString()} AMD (${basePricePct}%)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 2: Profit -->
                            <div class="space-y-2">
                                <div class="text-sm font-medium text-gray-700">Step 2: Profit Calculation</div>
                                <div class="pl-4 space-y-1 text-sm">
                                    <div class="flex justify-between">
                                        <span>Warranty Period:</span>
                                        <span>${warrantyYears} years</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Profit per kW:</span>
                                        <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="${profitPerKw.toLocaleString()} AMD">████████████</span>
                                    </div>
                                    <div class="flex justify-between font-medium">
                                        <span>Total Profit:</span>
                                        <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="${profitAmount.toLocaleString()} AMD (${profitPct}%)">████████████</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 3: Inverter -->
                            <div class="space-y-2">
                                <div class="text-sm font-medium text-gray-700">Step 3: Inverter Selection</div>
                                <div class="pl-4 space-y-1 text-sm">
                                    <div class="flex justify-between">
                                        <span>Selected Inverter:</span>
                                        <span>${inverterKw} kW</span>
                                    </div>
                                    <div class="flex justify-between font-medium">
                                        <span>Inverter Price:</span>
                                        <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="${inverterPrice.toLocaleString()} AMD (${inverterPct}%)">████████████</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 4: Subtotal -->
                            <div class="space-y-2 border-t pt-3">
                                <div class="text-sm font-medium text-gray-700">Step 4: Subtotal</div>
                                <div class="pl-4 space-y-1 text-sm">
                                    <div class="flex justify-between">
                                        <span>Base Price:</span>
                                        <span class="font-mono">${basePrice.toLocaleString()} AMD</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>+ Profit:</span>
                                        <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="${profitAmount.toLocaleString()} AMD">████████████</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>+ Inverter:</span>
                                        <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="${inverterPrice.toLocaleString()} AMD">████████████</span>
                                    </div>
                                    <div class="flex justify-between font-semibold border-t pt-1">
                                        <span>Subtotal:</span>
                                        <span class="font-mono">${basePriceWithProfitAndInverter.toLocaleString()} AMD</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 5: Final Calculation -->
                            <div class="space-y-2 border-t pt-3">
                                <div class="text-sm font-medium text-gray-700">Step 5: Final Price Calculation</div>
                                <div class="pl-4 space-y-1 text-sm">
                                    <div class="flex justify-between">
                                        <span>Subtotal:</span>
                                        <span class="font-mono">${basePriceWithProfitAndInverter.toLocaleString()} AMD</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>÷ (1 - Sales Team ${salesTeamPctDisplay}% - Unexpected ${unexpectedExpensesPctDisplay}%):</span>
                                        <span class="font-mono">÷ 0.92</span>
                                    </div>
                                    <div class="flex justify-between text-blue-600">
                                        <span>Sales Team (${salesTeamPctDisplay}%):</span>
                                        <span class="font-mono">${salesTeamAmount.toLocaleString()} AMD</span>
                                    </div>
                                    <div class="flex justify-between text-orange-600">
                                        <span>Unexpected Expenses (${unexpectedExpensesPctDisplay}%):</span>
                                        <span class="font-mono">${unexpectedExpensesAmount.toLocaleString()} AMD</span>
                                    </div>
                                    <div class="flex justify-between font-semibold text-green-600 border-t pt-1">
                                        <span>Final System Value:</span>
                                        <span class="font-mono">${totalSystemPrice.toLocaleString()} AMD</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>${selectedInverterText}</span>
                            <span>${inverterKw} kW</span>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('results').innerHTML = `
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="font-medium text-lg">${systemValueText}</span>
                            <span class="text-green-600 font-semibold text-lg">${totalSystemPrice.toLocaleString()} AMD</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>${selectedInverterText}</span>
                            <span>${inverterKw} kW</span>
                        </div>
                    </div>
                `;
            }

            // Calculate loan options
            const loanOptions = [];
            
            bankConfigurations.forEach(bank => {
                bank.options.forEach(option => {
                    option.periods.forEach(period => {
                        // Calculate loan amount with commission
                        const totalPercentage = option.commission;
                        const loanAmountWithCommission = Math.ceil(totalSystemPrice / (1 - totalPercentage));
                        
                        // Calculate actual loan amount (after down payment)
                        const actualLoanAmount = loanAmountWithCommission - 0; // No down payment for now
                        
                        // Calculate monthly payment
                        const monthlyPayment = Math.ceil(calculateLoanPayment(actualLoanAmount, option.interestRate, period));
                        const totalInterest = (monthlyPayment * period) - actualLoanAmount;
                        const totalAmount = monthlyPayment * period;
                        
                        loanOptions.push({
                            bankName: bank.name,
                            interestRate: option.interestRate,
                            commission: option.commission,
                            loanPeriod: period,
                            monthlyPayment: monthlyPayment,
                            totalInterest: totalInterest,
                            totalAmount: totalAmount,
                            loanAmount: actualLoanAmount
                        });
                    });
                });
            });

            // Store all options globally and sort by monthly payment
            allLoanOptions = loanOptions.sort((a, b) => a.monthlyPayment - b.monthlyPayment);
            
            // Populate filter dropdowns
            populateFilters();
            
            // Display all options initially
            displayLoanOptions(allLoanOptions);
            updateResultCount(allLoanOptions.length);
            
            // Set initial sort state
            currentSortField = 'monthlyPayment';
            currentSortDirection = 'asc';
            updateSortIcons('monthlyPayment', 'asc');

            document.getElementById('loanTable').classList.remove('hidden');
        }

        // Global variables for filtering and sorting
        let allLoanOptions = [];
        let currentSortField = '';
        let currentSortDirection = 'asc';
        let currentLanguage = 'en';

        // Language switching function
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Save language preference to localStorage
            localStorage.setItem('loanCalculatorLanguage', lang);
            
            // Update language buttons
            document.getElementById('langEn').className = lang === 'en' 
                ? 'px-3 py-1 rounded-md text-sm font-medium bg-tiamat-blue text-white'
                : 'px-3 py-1 rounded-md text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300';
            
            document.getElementById('langHy').className = lang === 'hy' 
                ? 'px-3 py-1 rounded-md text-sm font-medium bg-tiamat-blue text-white'
                : 'px-3 py-1 rounded-md text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300';
            
            // Update all elements with data attributes
            document.querySelectorAll('[data-en][data-hy]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
            
            // Update placeholders
            document.querySelectorAll('[data-en-placeholder][data-hy-placeholder]').forEach(element => {
                element.placeholder = element.getAttribute(`data-${lang}-placeholder`);
            });
            
            // Update select options
            document.querySelectorAll('option[data-en][data-hy]').forEach(option => {
                option.textContent = option.getAttribute(`data-${lang}`);
            });
            
            // Update result count if it exists
            const resultCount = document.getElementById('resultCount');
            if (resultCount && allLoanOptions.length > 0) {
                updateResultCount(allLoanOptions.length);
            }
            
            // Recalculate and display results if they exist
            if (allLoanOptions.length > 0) {
                calculateLoan();
            }
            
            // Update inverter dropdown language
            populateInverterDropdown();
        }

        // Populate inverter dropdown
        function populateInverterDropdown() {
            const inverterSelect = document.getElementById('inverterSelect');
            const systemPower = parseFloat(document.getElementById('systemPower').value) || 0;
            inverterSelect.innerHTML = '<option value="auto" data-en="Auto Select (Recommended)" data-hy="Ավտոմատ ընտրություն (Խորհուրդ է տրվում)">Auto Select (Recommended)</option>';
            
            // Only show inverters that are not more than 10% smaller than system power
            const minAllowedKw = systemPower * 0.9; // 10% less than system power
            
            inverters.forEach(inverter => {
                if (inverter.kw >= minAllowedKw) {
                    const option = document.createElement('option');
                    option.value = inverter.kw;
                    const text = currentLanguage === 'en' 
                        ? `${inverter.kw} kW`
                        : `${inverter.kw} կՎտ`;
                    option.textContent = text;
                    option.setAttribute('data-en', `${inverter.kw} kW`);
                    option.setAttribute('data-hy', `${inverter.kw} կՎտ`);
                    inverterSelect.appendChild(option);
                }
            });
        }

        // Set default values
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('systemPower').value = '10.44';
            
            // Populate inverter dropdown
            populateInverterDropdown();
            
            // Add event listeners for filters
            document.getElementById('bankFilter').addEventListener('change', applyFilters);
            document.getElementById('periodFilter').addEventListener('change', applyFilters);
            document.getElementById('sortBy').addEventListener('change', applySorting);
            
            // Add event listener for system power to update inverter dropdown
            document.getElementById('systemPower').addEventListener('input', populateInverterDropdown);
            
            // Add event listener for warranty years to recalculate when changed
            document.getElementById('warrantyYears').addEventListener('change', function() {
                if (allLoanOptions.length > 0) {
                    calculateLoan();
                }
            });
            
            // Load saved language preference
            const savedLanguage = localStorage.getItem('loanCalculatorLanguage');
            if (savedLanguage) {
                switchLanguage(savedLanguage);
            }
        });

        function populateFilters() {
            const bankFilter = document.getElementById('bankFilter');
            const periodFilter = document.getElementById('periodFilter');
            
            // Get unique banks and periods
            const banks = [...new Set(allLoanOptions.map(option => option.bankName))];
            const periods = [...new Set(allLoanOptions.map(option => option.loanPeriod))].sort((a, b) => a - b);
            
            // Clear existing options (except first)
            bankFilter.innerHTML = '<option value="">All Banks</option>';
            periodFilter.innerHTML = '<option value="">All Periods</option>';
            
            // Add bank options
            banks.forEach(bank => {
                const option = document.createElement('option');
                option.value = bank;
                option.textContent = bank;
                bankFilter.appendChild(option);
            });
            
            // Add period options
            periods.forEach(period => {
                const option = document.createElement('option');
                option.value = period;
                const monthsText = currentLanguage === 'en' ? 'months' : 'ամիս';
                option.textContent = `${period} ${monthsText}`;
                periodFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            // Apply current sorting
            if (currentSortField) {
                filteredOptions = sortOptions(filteredOptions, currentSortField, currentSortDirection);
            }
            
            displayLoanOptions(filteredOptions);
            updateResultCount(filteredOptions.length);
        }

        function applySorting() {
            const sortBy = document.getElementById('sortBy').value;
            if (!sortBy) return;
            
            const [field, direction] = sortBy.includes('Desc') 
                ? [sortBy.replace('Desc', ''), 'desc'] 
                : [sortBy, 'asc'];
            
            currentSortField = field;
            currentSortDirection = direction;
            
            // Get current filtered options
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            filteredOptions = sortOptions(filteredOptions, field, direction);
            displayLoanOptions(filteredOptions);
        }

        function sortOptions(options, field, direction) {
            return options.sort((a, b) => {
                let aVal = a[field];
                let bVal = b[field];
                
                // Handle string comparison
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
        }

        function sortTable(field) {
            // Toggle direction if same field
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
            
            // Get current filtered options
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            filteredOptions = sortOptions(filteredOptions, field, currentSortDirection);
            displayLoanOptions(filteredOptions);
            updateSortIcons(field, currentSortDirection);
        }

        function updateSortIcons(field, direction) {
            // Reset all icons
            const icons = ['bankSortIcon', 'periodSortIcon', 'rateSortIcon', 'commissionSortIcon',
                          'amountSortIcon', 'paymentSortIcon', 'interestSortIcon', 'totalSortIcon'];
            icons.forEach(id => {
                document.getElementById(id).textContent = '↕';
            });
            
            // Set active icon
            const iconMap = {
                'bankName': 'bankSortIcon',
                'loanPeriod': 'periodSortIcon',
                'interestRate': 'rateSortIcon',
                'commission': 'commissionSortIcon',
                'loanAmount': 'amountSortIcon',
                'monthlyPayment': 'paymentSortIcon',
                'totalInterest': 'interestSortIcon',
                'totalAmount': 'totalSortIcon'
            };
            
            const activeIcon = document.getElementById(iconMap[field]);
            if (activeIcon) {
                activeIcon.textContent = direction === 'asc' ? '↑' : '↓';
            }
        }

        function clearFilters() {
            document.getElementById('bankFilter').value = '';
            document.getElementById('periodFilter').value = '';
            document.getElementById('sortBy').value = 'monthlyPayment';
            
            currentSortField = 'monthlyPayment';
            currentSortDirection = 'asc';
            
            // Reset sort icons
            updateSortIcons('monthlyPayment', 'asc');
            
            // Display all options sorted by monthly payment
            const sortedOptions = sortOptions([...allLoanOptions], 'monthlyPayment', 'asc');
            displayLoanOptions(sortedOptions);
            updateResultCount(sortedOptions.length);
        }

        function updateResultCount(count) {
            const totalCount = allLoanOptions.length;
            const resultCount = document.getElementById('resultCount');
            
            if (currentLanguage === 'en') {
                resultCount.textContent = count === totalCount 
                    ? `Showing all ${totalCount} results` 
                    : `Showing ${count} of ${totalCount} results`;
            } else {
                resultCount.textContent = count === totalCount 
                    ? `Ցուցադրվում են բոլոր ${totalCount} արդյունքները` 
                    : `Ցուցադրվում են ${count} ${totalCount}-ից`;
            }
        }

        function displayLoanOptions(options) {
            const tableBody = document.getElementById('loanTableBody');
            tableBody.innerHTML = '';

            options.forEach(option => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                const monthsText = currentLanguage === 'en' ? 'months' : 'ամիս';
                
                // Create commission cell conditionally
                const commissionCell = isAdminLoggedIn 
                    ? `<td class="border p-3 text-center w-24 text-orange-600 font-medium">${(option.commission * 100).toFixed(1)}%</td>`
                    : '';
                
                row.innerHTML = `
                    <td class="border p-3 font-medium">${option.bankName}</td>
                    <td class="border p-3 text-center w-32">${option.loanPeriod} ${monthsText}</td>
                    <td class="border p-3 text-center w-24">${(option.interestRate * 100).toFixed(1)}%</td>
                    ${commissionCell}
                    <td class="border p-3 text-center font-semibold text-green-600 w-40">${option.loanAmount.toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-blue-600 w-36">${option.monthlyPayment.toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-red-600 w-40">${Math.abs(option.totalInterest).toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-purple-600 w-44">${option.totalAmount.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Admin functionality
        let isAdminLoggedIn = false;
        const ADMIN_PASSWORD = CONFIG.ADMIN_PASSWORD;

        function showAdminLogin() {
            document.getElementById('adminModal').classList.remove('hidden');
            document.getElementById('adminPassword').focus();
        }

        function hideAdminLogin() {
            document.getElementById('adminModal').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                hideAdminLogin();
                showAdminDetails();
                updateAdminButton();
                showCommissionColumn();
                // Recalculate to show detailed breakdown
                if (allLoanOptions.length > 0) {
                    calculateLoan();
                }
            } else {
                alert('Incorrect password');
            }
        }

        function logoutAdmin() {
            isAdminLoggedIn = false;
            hideAdminDetails();
            updateAdminButton();
            hideCommissionColumn();
            // Recalculate to hide detailed breakdown
            if (allLoanOptions.length > 0) {
                calculateLoan();
            }
        }

        function showCommissionColumn() {
            // Show commission header
            const commissionHeader = document.querySelector('.admin-only');
            if (commissionHeader) {
                commissionHeader.style.display = 'table-cell';
            }
        }

        function hideCommissionColumn() {
            // Hide commission header
            const commissionHeader = document.querySelector('.admin-only');
            if (commissionHeader) {
                commissionHeader.style.display = 'none';
            }
        }

        // Spoiler functionality
        function toggleSpoiler(element) {
            if (element.classList.contains('spoiler')) {
                // Show the actual value
                element.textContent = element.getAttribute('data-value');
                element.classList.remove('spoiler');
                element.classList.add('spoiler-revealed');
            } else {
                // Hide the value
                element.textContent = '████████████';
                element.classList.add('spoiler');
                element.classList.remove('spoiler-revealed');
            }
        }

        // Handle Enter key in admin password field
        function handleAdminPasswordKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                loginAdmin();
            }
        }

        function showAdminDetails() {
            document.getElementById('adminDetails').classList.remove('hidden');
        }

        function hideAdminDetails() {
            document.getElementById('adminDetails').classList.add('hidden');
        }

        function updateAdminButton() {
            const adminBtn = document.getElementById('adminLoginBtn');
            if (isAdminLoggedIn) {
                adminBtn.classList.remove('bg-gray-500', 'hover:bg-gray-600');
                adminBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                adminBtn.innerHTML = '<span data-en="Admin ✓" data-hy="Ադմին ✓">Admin ✓</span>';
            } else {
                adminBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                adminBtn.classList.add('bg-gray-500', 'hover:bg-gray-600');
                adminBtn.innerHTML = '<span data-en="Admin" data-hy="Ադմին">Admin</span>';
            }
        }

        // Add admin details section to the page
        function addAdminSection() {
            const adminSection = `
                <div id="adminDetails" class="bg-white rounded-lg shadow-md p-6 mt-6 hidden">
                    <h2 class="text-xl font-semibold mb-4 text-tiamat-blue" data-en="Admin: Calculation Details" data-hy="Ադմին: Հաշվարկի մանրամասները">Admin: Calculation Details</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Base Prices -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-gray-800" data-en="Base Prices (per kW, without inverter)" data-hy="Բազային գները (կՎտ-ի համար, առանց ինվերտորի)">Base Prices (per kW, without inverter)</h3>
                            <div class="bg-gray-50 p-4 rounded-md space-y-2">
                                <div class="flex justify-between">
                                    <span data-en="Aluminium Construction on Roof" data-hy="Ալյումինե կոնստրուկցիա տանիքի վրա">Aluminium Construction on Roof:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="130,000 AMD">████████████</span>
                                </div>
                                <div class="flex justify-between">
                                    <span data-en="Metal Construction on Roof" data-hy="Մետաղական կոնստրուկցիա տանիքի վրա">Metal Construction on Roof:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="115,000 AMD">████████████</span>
                                </div>
                                <div class="flex justify-between">
                                    <span data-en="On Roof (Sloped)" data-hy="Տանիքի վրա (լանջային)">On Roof (Sloped):</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="105,000 AMD">████████████</span>
                                </div>
                                <div class="flex justify-between">
                                    <span data-en="System on Ground" data-hy="Համակարգ գետնի վրա">System on Ground:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="117,000 AMD">████████████</span>
                                </div>
                            </div>
                        </div>

                        <!-- Profit by Warranty -->
                        <div class="space-y-4">
                            <h3 class="font-semibold text-gray-800" data-en="Profit per kW by Warranty" data-hy="Շահույթ կՎտ-ի համար ըստ երաշխիքի">Profit per kW by Warranty</h3>
                            <div class="bg-gray-50 p-4 rounded-md space-y-2">
                                <div class="flex justify-between">
                                    <span data-en="2 Years" data-hy="2 Տարի">2 Years:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="15,000 AMD">████████████</span>
                                </div>
                                <div class="flex justify-between">
                                    <span data-en="3 Years" data-hy="3 Տարի">3 Years:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="20,000 AMD">████████████</span>
                                </div>
                                <div class="flex justify-between">
                                    <span data-en="6 Years" data-hy="6 Տարի">6 Years:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="25,000 AMD">████████████</span>
                                </div>
                                <div class="flex justify-between">
                                    <span data-en="12 Years" data-hy="12 Տարի">12 Years:</span>
                                    <span class="font-mono spoiler" onclick="toggleSpoiler(this)" data-value="30,000 AMD">████████████</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Commission Rates -->
                    <div class="mt-6">
                        <h3 class="font-semibold text-gray-800 mb-4" data-en="Bank Commission Rates" data-hy="Բանկի կոմիսիոն վճարներ">Bank Commission Rates</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- ArmEconomBank -->
                            <div>
                                <h4 class="font-medium text-gray-700 mb-2">ArmEconomBank</h4>
                                <div class="bg-gray-50 p-4 rounded-md text-sm space-y-1">
                                    <div class="grid grid-cols-3 gap-2 text-xs font-medium text-gray-600">
                                        <span>Period</span>
                                        <span>Interest</span>
                                        <span>Commission</span>
                                    </div>
                                    <div class="space-y-1">
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>36m</span><span>0%</span><span>21%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>60m</span><span>0%</span><span>32%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>84m</span><span>0%</span><span>41%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>36m</span><span>3%</span><span>18%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>60m</span><span>3%</span><span>27%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>84m</span><span>3%</span><span>34%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>36m</span><span>5%</span><span>16%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>60m</span><span>5%</span><span>23%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>84m</span><span>5%</span><span>30%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>36m</span><span>9%</span><span>10%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>60m</span><span>9%</span><span>15%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>84m</span><span>9%</span><span>19%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>36m</span><span>12%</span><span>6%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>60m</span><span>12%</span><span>9%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>84m</span><span>12%</span><span>11%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>36m</span><span>15%</span><span>2%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>60m</span><span>15%</span><span>3%</span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>84m</span><span>15%</span><span>4%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ACBA Bank -->
                            <div>
                                <h4 class="font-medium text-gray-700 mb-2">ACBA Bank</h4>
                                <div class="bg-gray-50 p-4 rounded-md text-sm space-y-1">
                                    <div class="grid grid-cols-3 gap-2 text-xs font-medium text-gray-600">
                                        <span>Period</span>
                                        <span>Interest</span>
                                        <span>Commission</span>
                                    </div>
                                    <div class="space-y-1">
                                        <div class="grid grid-cols-3 gap-2">
                                            <span>96m</span><span>11%</span><span>4%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Logout Button -->
                    <div class="mt-6 text-center">
                        <button onclick="logoutAdmin()" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                            <span data-en="Logout Admin" data-hy="Դուրս գալ ադմինից">Logout Admin</span>
                        </button>
                    </div>
                </div>
            `;
            
            // Insert admin section after the loan table
            const loanTable = document.getElementById('loanTable');
            loanTable.insertAdjacentHTML('afterend', adminSection);
        }

        // Initialize admin section on page load
        document.addEventListener('DOMContentLoaded', function() {
            addAdminSection();
        });

        // Keyboard shortcut for admin login (A+S+D+Space+Enter+Enter)
        let keySequence = [];
        let lastKeyTime = 0;
        
        document.addEventListener('keydown', function(event) {
            const currentTime = Date.now();
            
            // Reset sequence if too much time has passed (2 seconds)
            if (currentTime - lastKeyTime > 2000) {
                keySequence = [];
            }
            
            lastKeyTime = currentTime;
            
            // Track all key presses
            let keyPressed = '';
            
            if (event.code === 'KeyA') {
                keyPressed = 'A';
            } else if (event.code === 'KeyS') {
                keyPressed = 'S';
            } else if (event.code === 'KeyD') {
                keyPressed = 'D';
            } else if (event.key === ' ') {
                keyPressed = 'Space';
            } else if (event.code === 'Enter') {
                keyPressed = 'Enter';
            }
            
            if (keyPressed) {
                keySequence.push(keyPressed);
                
                // Keep only last 6 keys
                if (keySequence.length > 6) {
                    keySequence.shift();
                }
                
                // Debug: log the sequence
                console.log('Key sequence:', keySequence);
                
                // Check if sequence matches admin shortcut: A+S+D+Space+Enter+Enter
                if (keySequence.length === 6 && 
                    keySequence[0] === 'A' && 
                    keySequence[1] === 'S' && 
                    keySequence[2] === 'D' && 
                    keySequence[3] === 'Space' && 
                    keySequence[4] === 'Enter' && 
                    keySequence[5] === 'Enter') {
                    
                    // Prevent default behavior
                    event.preventDefault();
                    
                    // Show admin login
                    showAdminLogin();
                    
                    // Reset sequence
                    keySequence = [];
                    console.log('Admin shortcut activated!');
                }
            }
        });
    </script>

    <!-- Admin Login Modal -->
    <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-lg font-semibold mb-4" data-en="Admin Login" data-hy="Ադմին մուտք">Admin Login</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Password" data-hy="Գաղտնաբառ">Password</label>
                        <input type="password" id="adminPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue" onkeydown="handleAdminPasswordKeydown(event)">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loginAdmin()" class="flex-1 bg-tiamat-blue text-white px-4 py-2 rounded-md hover:bg-tiamat-dark-blue">
                            <span data-en="Login" data-hy="Մուտք">Login</span>
                        </button>
                        <button onclick="hideAdminLogin()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                            <span data-en="Cancel" data-hy="Չեղարկել">Cancel</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 