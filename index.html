<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Loan Calculator</title>
    <link rel="icon" type="image/x-icon" href="tIAMAT white blue-06.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tiamat-blue': '#0066CC',
                        'tiamat-light-blue': '#4A90E2',
                        'tiamat-dark-blue': '#004499',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 space-y-6">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
                <img src="tIAMAT white blue-06.ico" alt="Tiamat Logo" class="h-8 w-8">
                <h1 class="text-3xl font-bold text-tiamat-blue" data-en="Solar Loan Calculator" data-hy="Արևային կայանի վարկի հաշվիչ">Solar Loan Calculator</h1>
            </div>
            
            <!-- Language Switcher -->
            <div class="flex items-center gap-2">
                <button onclick="switchLanguage('en')" id="langEn" class="px-3 py-1 rounded-md text-sm font-medium bg-tiamat-blue text-white">EN</button>
                <button onclick="switchLanguage('hy')" id="langHy" class="px-3 py-1 rounded-md text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300">ՀԱՅ</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Input Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4" data-en="System Configuration" data-hy="Համակարգի կարգավորում">System Configuration</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-en="System Power (kW)" data-hy="Համակարգի հզորություն (կՎտ)">System Power (kW)</label>
                        <input type="number" id="systemPower" data-en-placeholder="Enter system power" data-hy-placeholder="Մուտքագրեք համակարգի հզորությունը" placeholder="Enter system power" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Installation Type" data-hy="Տեղադրման տեսակը">Installation Type</label>
                        <select id="installationType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                            <option value="onRoof" data-en="On Roof" data-hy="Տանիքի վրա (լանջային)">On Roof</option>
                            <option value="metalConstructionOnRoof" data-en="Metal Construction on Roof" data-hy="Մետաղական կոնստրուկցիա տանիքի վրա">Metal Construction on Roof</option>
                            <option value="aluminiumConstructionOnRoof" data-en="Aluminium Construction on Roof" data-hy="Ալյումինե կոնստրուկցիա տանիքի վրա">Aluminium Construction on Roof</option>
                            <option value="systemOnGround" data-en="System on Ground" data-hy="Համակարգ գետնի վրա">System on Ground</option>
                        </select>
                    </div>

                    <button onclick="calculateLoan()" 
                            class="w-full bg-tiamat-blue hover:bg-tiamat-dark-blue text-white font-semibold py-2 px-4 rounded-md transition-colors"
                            data-en="Calculate Loan Options" data-hy="Հաշվարկել վարկի տարբերակները">
                        Calculate Loan Options
                    </button>
                </div>
            </div>

            <!-- Results -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4" data-en="Calculation Results" data-hy="Հաշվարկի արդյունքները">Calculation Results</h2>
                
                <div id="results" class="space-y-4">
                    <div class="text-center text-gray-500" data-en="Enter system parameters and click 'Calculate Loan Options' to see results" data-hy="Մուտքագրեք համակարգի պարամետրերը և սեղմեք 'Հաշվարկել վարկի տարբերակները' արդյունքները տեսնելու համար">
                        Enter system parameters and click "Calculate Loan Options" to see results
                    </div>
                </div>
            </div>
        </div>

        <!-- Loan Options Table -->
        <div id="loanTable" class="bg-white rounded-lg shadow-md p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Available Loan Options</h2>
            
            <!-- Filters and Sorting -->
            <div class="mb-4 flex flex-wrap gap-4 items-center">
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700" data-en="Filter by Bank:" data-hy="Զտել ըստ բանկի:">Filter by Bank:</label>
                    <select id="bankFilter" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="" data-en="All Banks" data-hy="Բոլոր բանկերը">All Banks</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700" data-en="Filter by Period:" data-hy="Զտել ըստ ժամկետի:">Filter by Period:</label>
                    <select id="periodFilter" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="" data-en="All Periods" data-hy="Ամբողջը">All Periods</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700" data-en="Sort by:" data-hy="Դասավորել ըստ:">Sort by:</label>
                    <select id="sortBy" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-tiamat-blue">
                        <option value="monthlyPayment" data-en="Monthly Payment (Low to High)" data-hy="Ամսական վճար (ցածրից բարձր)">Monthly Payment (Low to High)</option>
                        <option value="monthlyPaymentDesc" data-en="Monthly Payment (High to Low)" data-hy="Ամսական վճար (բարձրից ցածր)">Monthly Payment (High to Low)</option>
                        <option value="loanAmount" data-en="Loan Amount (Low to High)" data-hy="Վարկի գումար (ցածրից բարձր)">Loan Amount (Low to High)</option>
                        <option value="loanAmountDesc" data-en="Loan Amount (High to Low)" data-hy="Վարկի գումար (բարձրից ցածր)">Loan Amount (High to Low)</option>
                        <option value="totalAmount" data-en="Total Amount (Low to High)" data-hy="Ընդհանուր գումար (ցածրից բարձր)">Total Amount (Low to High)</option>
                        <option value="totalAmountDesc" data-en="Total Amount (High to Low)" data-hy="Ընդհանուր գումար (բարձրից ցածր)">Total Amount (High to Low)</option>
                        <option value="interestRate" data-en="Interest Rate (Low to High)" data-hy="Տոկոսադրույք (ցածրից բարձր)">Interest Rate (Low to High)</option>
                        <option value="interestRateDesc" data-en="Interest Rate (High to Low)" data-hy="Տոկոսադրույք (բարձրից ցածր)">Interest Rate (High to Low)</option>

                        <option value="loanPeriod" data-en="Loan Period (Low to High)" data-hy="Վարկի ժամկետ (ցածրից բարձր)">Loan Period (Low to High)</option>
                        <option value="loanPeriodDesc" data-en="Loan Period (High to Low)" data-hy="Վարկի ժամկետ (բարձրից ցածր)">Loan Period (High to Low)</option>
                    </select>
                </div>
                
                <button onclick="clearFilters()" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md text-sm transition-colors"
                        data-en="Clear Filters" data-hy="Մաքրել զտիչները">
                    Clear Filters
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border p-3 text-left font-medium cursor-pointer hover:bg-gray-100" onclick="sortTable('bankName')">
                                <span data-en="Bank" data-hy="Բանկ">Bank</span> <span id="bankSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-32 cursor-pointer hover:bg-gray-100" onclick="sortTable('loanPeriod')">
                                <span data-en="Loan Period" data-hy="Վարկի ժամկետ">Loan Period</span> <span id="periodSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-24 cursor-pointer hover:bg-gray-100" onclick="sortTable('interestRate')">
                                <span data-en="Interest Rate" data-hy="Տոկոսադրույք">Interest Rate</span> <span id="rateSortIcon" class="ml-1">↕</span>
                            </th>

                            <th class="border p-3 text-center font-medium w-40 cursor-pointer hover:bg-gray-100" onclick="sortTable('loanAmount')">
                                <span data-en="Loan Amount" data-hy="Վարկի գումար">Loan Amount</span> <span id="amountSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-36 cursor-pointer hover:bg-gray-100" onclick="sortTable('monthlyPayment')">
                                <span data-en="Monthly Payment" data-hy="Ամսական վճար">Monthly Payment</span> <span id="paymentSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-40 cursor-pointer hover:bg-gray-100" onclick="sortTable('totalInterest')">
                                <span data-en="Total Interest" data-hy="Ընդհանուր տոկոս">Total Interest</span> <span id="interestSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-44 cursor-pointer hover:bg-gray-100" onclick="sortTable('totalAmount')">
                                <span data-en="Total Amount" data-hy="Ընդհանուր գումար">Total Amount</span> <span id="totalSortIcon" class="ml-1">↕</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="loanTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4 text-sm text-gray-600">
                <span id="resultCount" data-en="Showing all results" data-hy="Ցուցադրվում են բոլոր արդյունքները">Showing all results</span>
            </div>
        </div>
    </div>

    <script>
        // Bank configurations
        const bankConfigurations = [
            {
                name: 'ArmEconomBank',
                options: [
                    { interestRate: 0, commission: 0.21, periods: [36] },
                    { interestRate: 0, commission: 0.32, periods: [60] },
                    { interestRate: 0, commission: 0.41, periods: [84] },
                    { interestRate: 0.03, commission: 0.18, periods: [36] },
                    { interestRate: 0.03, commission: 0.27, periods: [60] },
                    { interestRate: 0.03, commission: 0.34, periods: [84] },
                    { interestRate: 0.05, commission: 0.16, periods: [36] },
                    { interestRate: 0.05, commission: 0.23, periods: [60] },
                    { interestRate: 0.05, commission: 0.3, periods: [84] },
                    { interestRate: 0.09, commission: 0.1, periods: [36] },
                    { interestRate: 0.09, commission: 0.15, periods: [60] },
                    { interestRate: 0.09, commission: 0.19, periods: [84] },
                    { interestRate: 0.12, commission: 0.06, periods: [36] },
                    { interestRate: 0.12, commission: 0.09, periods: [60] },
                    { interestRate: 0.12, commission: 0.11, periods: [84] },
                    { interestRate: 0.15, commission: 0.02, periods: [36] },
                    { interestRate: 0.15, commission: 0.03, periods: [60] },
                    { interestRate: 0.15, commission: 0.04, periods: [84] }
                ]
            },
            {
                name: 'ACBA Bank',
                options: [
                    { interestRate: 0.11, commission: 0.04, periods: [96] }
                ]
            }
        ];

        function calculateLoanPayment(principal, annualRate, months) {
            const monthlyRate = annualRate / 12;
            if (monthlyRate === 0) return principal / months;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
        }

        // Inverter list (use upper price for duplicates)
        const inverters = [
            { kw: 3, price: 201600 },
            { kw: 3.6, price: 208800 },
            { kw: 5.3, price: 237600 },
            { kw: 6, price: 396000 },
            { kw: 8, price: 417600 },
            { kw: 10, price: 432000 }, // upper price for 10kW
            { kw: 12, price: 446400 },
            { kw: 15, price: 460800 },
            { kw: 20, price: 532800 },
            { kw: 25, price: 576000 },
            { kw: 30, price: 936000 },
            { kw: 40, price: 1036800 },
            { kw: 50, price: 1094400 },
            { kw: 60, price: 1180800 },
            { kw: 75, price: 1260000 },
            { kw: 100, price: 1648800 },
            { kw: 110, price: 1728000 }
        ];

        // New base prices per kW (without inverter)
        const basePrices = {
            aluminiumConstructionOnRoof: 130000,
            metalConstructionOnRoof: 115000,
            onRoof: 105000,
            systemOnGround: 117000
        };

        function calculateLoan() {
            // Get input values
            const systemPower = parseFloat(document.getElementById('systemPower').value);
            const installationType = document.getElementById('installationType').value;

            if (!systemPower) {
                alert('Please enter system power');
                return;
            }

            // Get base price per kW (without inverter)
            let basePricePerKw = basePrices[installationType] || 130000;
            const basePrice = systemPower * basePricePerKw;

            // Check if system is larger than 110 kW
            if (systemPower > 110) {
                const message = currentLanguage === 'en' 
                    ? 'System size exceeds 110 kW. Please contact upper management for pricing.'
                    : 'Համակարգի չափը գերազանցում է 110 կՎտ-ը: Խնդրում ենք կապ հաստատել վերին ղեկավարության հետ գնագոյացման համար:';
                
                document.getElementById('results').innerHTML = `
                    <div class="space-y-3">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-yellow-800 font-medium">${message}</span>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            // Find inverter: smallest inverter where inverter.kw * 1.15 >= systemPower
            let selectedInverter = null;
            for (let i = 0; i < inverters.length; i++) {
                if (inverters[i].kw * 1.15 >= systemPower) {
                    selectedInverter = inverters[i];
                    break;
                }
            }
            if (!selectedInverter) {
                alert('No suitable inverter found for this system size!');
                return;
            }
            const inverterPrice = selectedInverter.price;
            const inverterKw = selectedInverter.kw;

            // Total system price
            const totalSystemPrice = basePrice + inverterPrice;

            // Display results
            const systemValueText = currentLanguage === 'en' ? 'System Value for Cash:' : 'Կանխիկ վաճառքի գին:';
            const inverterText = currentLanguage === 'en' ? 'Inverter (kW, price):' : 'Ինվերտոր (կՎտ, գին):';
            document.getElementById('results').innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="font-medium text-lg">${systemValueText}</span>
                        <span class="text-green-600 font-semibold text-lg">${totalSystemPrice.toLocaleString()} AMD</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">${inverterText}</span>
                        <span>${inverterKw} kW, ${inverterPrice.toLocaleString()} AMD</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">Base Price (no inverter):</span>
                        <span>${basePrice.toLocaleString()} AMD</span>
                    </div>
                </div>
            `;

            // Calculate loan options
            const loanOptions = [];
            
            bankConfigurations.forEach(bank => {
                bank.options.forEach(option => {
                    option.periods.forEach(period => {
                        // Calculate loan amount with commission
                        const totalPercentage = option.commission;
                        const loanAmountWithCommission = totalSystemPrice / (1 - totalPercentage);
                        
                        // Calculate actual loan amount (after down payment)
                        const actualLoanAmount = loanAmountWithCommission - 0; // No down payment for now
                        
                        // Calculate monthly payment
                        const monthlyPayment = calculateLoanPayment(actualLoanAmount, option.interestRate, period);
                        const totalInterest = (monthlyPayment * period) - actualLoanAmount;
                        const totalAmount = monthlyPayment * period;
                        
                        loanOptions.push({
                            bankName: bank.name,
                            interestRate: option.interestRate,
                            commission: option.commission,
                            loanPeriod: period,
                            monthlyPayment: Math.round(monthlyPayment),
                            totalInterest: Math.round(totalInterest),
                            totalAmount: Math.round(totalAmount),
                            loanAmount: Math.round(actualLoanAmount)
                        });
                    });
                });
            });

            // Store all options globally and sort by monthly payment
            allLoanOptions = loanOptions.sort((a, b) => a.monthlyPayment - b.monthlyPayment);
            
            // Populate filter dropdowns
            populateFilters();
            
            // Display all options initially
            displayLoanOptions(allLoanOptions);
            updateResultCount(allLoanOptions.length);
            
            // Set initial sort state
            currentSortField = 'monthlyPayment';
            currentSortDirection = 'asc';
            updateSortIcons('monthlyPayment', 'asc');

            document.getElementById('loanTable').classList.remove('hidden');
        }

        // Global variables for filtering and sorting
        let allLoanOptions = [];
        let currentSortField = '';
        let currentSortDirection = 'asc';
        let currentLanguage = 'en';

        // Language switching function
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Save language preference to localStorage
            localStorage.setItem('loanCalculatorLanguage', lang);
            
            // Update language buttons
            document.getElementById('langEn').className = lang === 'en' 
                ? 'px-3 py-1 rounded-md text-sm font-medium bg-tiamat-blue text-white'
                : 'px-3 py-1 rounded-md text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300';
            
            document.getElementById('langHy').className = lang === 'hy' 
                ? 'px-3 py-1 rounded-md text-sm font-medium bg-tiamat-blue text-white'
                : 'px-3 py-1 rounded-md text-sm font-medium bg-gray-200 text-gray-700 hover:bg-gray-300';
            
            // Update all elements with data attributes
            document.querySelectorAll('[data-en][data-hy]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
            
            // Update placeholders
            document.querySelectorAll('[data-en-placeholder][data-hy-placeholder]').forEach(element => {
                element.placeholder = element.getAttribute(`data-${lang}-placeholder`);
            });
            
            // Update select options
            document.querySelectorAll('option[data-en][data-hy]').forEach(option => {
                option.textContent = option.getAttribute(`data-${lang}`);
            });
            
            // Update result count if it exists
            const resultCount = document.getElementById('resultCount');
            if (resultCount && allLoanOptions.length > 0) {
                updateResultCount(allLoanOptions.length);
            }
            
            // Recalculate and display results if they exist
            if (allLoanOptions.length > 0) {
                calculateLoan();
            }
        }

        // Set default values
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('systemPower').value = '10.44';
            
            // Add event listeners for filters
            document.getElementById('bankFilter').addEventListener('change', applyFilters);
            document.getElementById('periodFilter').addEventListener('change', applyFilters);
            document.getElementById('sortBy').addEventListener('change', applySorting);
            
            // Load saved language preference
            const savedLanguage = localStorage.getItem('loanCalculatorLanguage');
            if (savedLanguage) {
                switchLanguage(savedLanguage);
            }
        });

        function populateFilters() {
            const bankFilter = document.getElementById('bankFilter');
            const periodFilter = document.getElementById('periodFilter');
            
            // Get unique banks and periods
            const banks = [...new Set(allLoanOptions.map(option => option.bankName))];
            const periods = [...new Set(allLoanOptions.map(option => option.loanPeriod))].sort((a, b) => a - b);
            
            // Clear existing options (except first)
            bankFilter.innerHTML = '<option value="">All Banks</option>';
            periodFilter.innerHTML = '<option value="">All Periods</option>';
            
            // Add bank options
            banks.forEach(bank => {
                const option = document.createElement('option');
                option.value = bank;
                option.textContent = bank;
                bankFilter.appendChild(option);
            });
            
            // Add period options
            periods.forEach(period => {
                const option = document.createElement('option');
                option.value = period;
                const monthsText = currentLanguage === 'en' ? 'months' : 'ամիս';
                option.textContent = `${period} ${monthsText}`;
                periodFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            // Apply current sorting
            if (currentSortField) {
                filteredOptions = sortOptions(filteredOptions, currentSortField, currentSortDirection);
            }
            
            displayLoanOptions(filteredOptions);
            updateResultCount(filteredOptions.length);
        }

        function applySorting() {
            const sortBy = document.getElementById('sortBy').value;
            if (!sortBy) return;
            
            const [field, direction] = sortBy.includes('Desc') 
                ? [sortBy.replace('Desc', ''), 'desc'] 
                : [sortBy, 'asc'];
            
            currentSortField = field;
            currentSortDirection = direction;
            
            // Get current filtered options
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            filteredOptions = sortOptions(filteredOptions, field, direction);
            displayLoanOptions(filteredOptions);
        }

        function sortOptions(options, field, direction) {
            return options.sort((a, b) => {
                let aVal = a[field];
                let bVal = b[field];
                
                // Handle string comparison
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
        }

        function sortTable(field) {
            // Toggle direction if same field
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
            
            // Get current filtered options
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            filteredOptions = sortOptions(filteredOptions, field, currentSortDirection);
            displayLoanOptions(filteredOptions);
            updateSortIcons(field, currentSortDirection);
        }

        function updateSortIcons(field, direction) {
            // Reset all icons
            const icons = ['bankSortIcon', 'periodSortIcon', 'rateSortIcon', 
                          'amountSortIcon', 'paymentSortIcon', 'interestSortIcon', 'totalSortIcon'];
            icons.forEach(id => {
                document.getElementById(id).textContent = '↕';
            });
            
            // Set active icon
            const iconMap = {
                'bankName': 'bankSortIcon',
                'loanPeriod': 'periodSortIcon',
                'interestRate': 'rateSortIcon',
                'loanAmount': 'amountSortIcon',
                'monthlyPayment': 'paymentSortIcon',
                'totalInterest': 'interestSortIcon',
                'totalAmount': 'totalSortIcon'
            };
            
            const activeIcon = document.getElementById(iconMap[field]);
            if (activeIcon) {
                activeIcon.textContent = direction === 'asc' ? '↑' : '↓';
            }
        }

        function clearFilters() {
            document.getElementById('bankFilter').value = '';
            document.getElementById('periodFilter').value = '';
            document.getElementById('sortBy').value = 'monthlyPayment';
            
            currentSortField = 'monthlyPayment';
            currentSortDirection = 'asc';
            
            // Reset sort icons
            updateSortIcons('monthlyPayment', 'asc');
            
            // Display all options sorted by monthly payment
            const sortedOptions = sortOptions([...allLoanOptions], 'monthlyPayment', 'asc');
            displayLoanOptions(sortedOptions);
            updateResultCount(sortedOptions.length);
        }

        function updateResultCount(count) {
            const totalCount = allLoanOptions.length;
            const resultCount = document.getElementById('resultCount');
            
            if (currentLanguage === 'en') {
                resultCount.textContent = count === totalCount 
                    ? `Showing all ${totalCount} results` 
                    : `Showing ${count} of ${totalCount} results`;
            } else {
                resultCount.textContent = count === totalCount 
                    ? `Ցուցադրվում են բոլոր ${totalCount} արդյունքները` 
                    : `Ցուցադրվում են ${count} ${totalCount}-ից`;
            }
        }

        function displayLoanOptions(options) {
            const tableBody = document.getElementById('loanTableBody');
            tableBody.innerHTML = '';

            options.forEach(option => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                const monthsText = currentLanguage === 'en' ? 'months' : 'ամիս';
                row.innerHTML = `
                    <td class="border p-3 font-medium">${option.bankName}</td>
                    <td class="border p-3 text-center w-32">${option.loanPeriod} ${monthsText}</td>
                    <td class="border p-3 text-center w-24">${(option.interestRate * 100).toFixed(1)}%</td>
                    <td class="border p-3 text-center font-semibold text-green-600 w-40">${option.loanAmount.toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-blue-600 w-36">${option.monthlyPayment.toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-red-600 w-40">${Math.abs(option.totalInterest).toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-purple-600 w-44">${option.totalAmount.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }
    </script>
</body>
</html> 