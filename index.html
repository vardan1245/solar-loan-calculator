<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Loan Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'solar-yellow': '#FFD700',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 space-y-6">
        <div class="flex items-center gap-3 mb-6">
            <svg class="h-8 w-8 text-solar-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg>
            <h1 class="text-3xl font-bold text-gray-900">Solar Loan Calculator</h1>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Input Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">System Configuration</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">System Power (kW)</label>
                        <input type="number" id="systemPower" placeholder="Enter system power" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-solar-yellow">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Installation Type</label>
                        <select id="installationType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-solar-yellow">
                            <option value="onRoof">On Roof</option>
                            <option value="metalConstructionOnRoof">Metal Construction on Roof</option>
                            <option value="aluminiumConstructionOnRoof">Aluminium Construction on Roof</option>
                            <option value="systemOnGround">System on Ground</option>
                        </select>
                    </div>

                    <button onclick="calculateLoan()" 
                            class="w-full bg-solar-yellow hover:bg-yellow-400 text-gray-900 font-semibold py-2 px-4 rounded-md transition-colors">
                        Calculate Loan Options
                    </button>
                </div>
            </div>

            <!-- Results -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Calculation Results</h2>
                
                <div id="results" class="space-y-4">
                    <div class="text-center text-gray-500">
                        Enter system parameters and click "Calculate Loan Options" to see results
                    </div>
                </div>
            </div>
        </div>

        <!-- Loan Options Table -->
        <div id="loanTable" class="bg-white rounded-lg shadow-md p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Available Loan Options</h2>
            
            <!-- Filters and Sorting -->
            <div class="mb-4 flex flex-wrap gap-4 items-center">
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Filter by Bank:</label>
                    <select id="bankFilter" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-solar-yellow">
                        <option value="">All Banks</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Filter by Period:</label>
                    <select id="periodFilter" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-solar-yellow">
                        <option value="">All Periods</option>
                    </select>
                </div>
                
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Sort by:</label>
                    <select id="sortBy" class="px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-solar-yellow">
                        <option value="monthlyPayment">Monthly Payment (Low to High)</option>
                        <option value="monthlyPaymentDesc">Monthly Payment (High to Low)</option>
                        <option value="loanAmount">Loan Amount (Low to High)</option>
                        <option value="loanAmountDesc">Loan Amount (High to Low)</option>
                        <option value="totalAmount">Total Amount (Low to High)</option>
                        <option value="totalAmountDesc">Total Amount (High to Low)</option>
                        <option value="interestRate">Interest Rate (Low to High)</option>
                        <option value="interestRateDesc">Interest Rate (High to Low)</option>
                        <option value="commission">Commission (Low to High)</option>
                        <option value="commissionDesc">Commission (High to Low)</option>
                        <option value="loanPeriod">Loan Period (Low to High)</option>
                        <option value="loanPeriodDesc">Loan Period (High to Low)</option>
                    </select>
                </div>
                
                <button onclick="clearFilters()" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md text-sm transition-colors">
                    Clear Filters
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border p-3 text-left font-medium cursor-pointer hover:bg-gray-100" onclick="sortTable('bankName')">
                                Bank <span id="bankSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-32 cursor-pointer hover:bg-gray-100" onclick="sortTable('loanPeriod')">
                                Loan Period <span id="periodSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-24 cursor-pointer hover:bg-gray-100" onclick="sortTable('interestRate')">
                                Interest Rate <span id="rateSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-28 cursor-pointer hover:bg-gray-100" onclick="sortTable('commission')">
                                Commission <span id="commissionSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-40 cursor-pointer hover:bg-gray-100" onclick="sortTable('loanAmount')">
                                Loan Amount <span id="amountSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-36 cursor-pointer hover:bg-gray-100" onclick="sortTable('monthlyPayment')">
                                Monthly Payment <span id="paymentSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-40 cursor-pointer hover:bg-gray-100" onclick="sortTable('totalInterest')">
                                Total Interest <span id="interestSortIcon" class="ml-1">↕</span>
                            </th>
                            <th class="border p-3 text-center font-medium w-44 cursor-pointer hover:bg-gray-100" onclick="sortTable('totalAmount')">
                                Total Amount <span id="totalSortIcon" class="ml-1">↕</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="loanTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4 text-sm text-gray-600">
                <span id="resultCount">Showing all results</span>
            </div>
        </div>
    </div>

    <script>
        // Bank configurations
        const bankConfigurations = [
            {
                name: 'ArmEconomBank',
                options: [
                    { interestRate: 0, commission: 0.21, periods: [36] },
                    { interestRate: 0, commission: 0.32, periods: [60] },
                    { interestRate: 0, commission: 0.41, periods: [84] },
                    { interestRate: 0.03, commission: 0.18, periods: [36] },
                    { interestRate: 0.03, commission: 0.27, periods: [60] },
                    { interestRate: 0.03, commission: 0.34, periods: [84] },
                    { interestRate: 0.05, commission: 0.16, periods: [36] },
                    { interestRate: 0.05, commission: 0.23, periods: [60] },
                    { interestRate: 0.05, commission: 0.3, periods: [84] },
                    { interestRate: 0.09, commission: 0.1, periods: [36] },
                    { interestRate: 0.09, commission: 0.15, periods: [60] },
                    { interestRate: 0.09, commission: 0.19, periods: [84] },
                    { interestRate: 0.12, commission: 0.06, periods: [36] },
                    { interestRate: 0.12, commission: 0.09, periods: [60] },
                    { interestRate: 0.12, commission: 0.11, periods: [84] },
                    { interestRate: 0.15, commission: 0.02, periods: [36] },
                    { interestRate: 0.15, commission: 0.03, periods: [60] },
                    { interestRate: 0.15, commission: 0.04, periods: [84] }
                ]
            },
            {
                name: 'ACBA Bank',
                options: [
                    { interestRate: 0.11, commission: 0.04, periods: [96] }
                ]
            }
        ];

        function calculateLoanPayment(principal, annualRate, months) {
            const monthlyRate = annualRate / 12;
            if (monthlyRate === 0) return principal / months;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
        }

        function calculateLoan() {
            // Get input values
            const systemPower = parseFloat(document.getElementById('systemPower').value);
            const installationType = document.getElementById('installationType').value;

            if (!systemPower) {
                alert('Please enter system power');
                return;
            }

            // Fixed values
            const profitPerKw = 30000;
            const salesTeamPct = 0.06; // 6%
            const unanticipatedExpensesPct = 0.02; // 2%
            const downPaymentAmount = 0;

            // Get cost per kW based on installation type
            let costPerKw;
            switch(installationType) {
                case 'onRoof':
                    costPerKw = 147000;
                    break;
                case 'metalConstructionOnRoof':
                    costPerKw = 155000;
                    break;
                case 'systemOnGround':
                    costPerKw = 160000;
                    break;
                case 'aluminiumConstructionOnRoof':
                    costPerKw = 175000;
                    break;
                default:
                    costPerKw = 147000;
            }

            // Calculate base value
            const baseValue = systemPower * (costPerKw + profitPerKw);
            
            // Calculate system value for cash (without bank commission)
            const systemValueForCash = baseValue / (1 - salesTeamPct - unanticipatedExpensesPct);

            // Display results
            document.getElementById('results').innerHTML = `
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="font-medium">Base Value:</span>
                        <span class="text-green-600 font-semibold">${baseValue.toLocaleString()} AMD</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-medium">System Value for Cash:</span>
                        <span class="text-green-600 font-semibold">${systemValueForCash.toLocaleString()} AMD</span>
                    </div>
                </div>
            `;

            // Calculate loan options
            const loanOptions = [];
            
            bankConfigurations.forEach(bank => {
                bank.options.forEach(option => {
                    option.periods.forEach(period => {
                        // Calculate loan amount with commission
                        const totalPercentage = salesTeamPct + unanticipatedExpensesPct + option.commission;
                        const loanAmountWithCommission = baseValue / (1 - totalPercentage);
                        
                        // Calculate actual loan amount (after down payment)
                        const actualLoanAmount = loanAmountWithCommission - downPaymentAmount;
                        
                        // Calculate monthly payment
                        const monthlyPayment = calculateLoanPayment(actualLoanAmount, option.interestRate, period);
                        const totalInterest = (monthlyPayment * period) - actualLoanAmount;
                        const totalAmount = monthlyPayment * period;
                        
                        loanOptions.push({
                            bankName: bank.name,
                            interestRate: option.interestRate,
                            commission: option.commission,
                            loanPeriod: period,
                            monthlyPayment: Math.round(monthlyPayment),
                            totalInterest: Math.round(totalInterest),
                            totalAmount: Math.round(totalAmount),
                            loanAmount: Math.round(actualLoanAmount)
                        });
                    });
                });
            });

            // Store all options globally and sort by monthly payment
            allLoanOptions = loanOptions.sort((a, b) => a.monthlyPayment - b.monthlyPayment);
            
            // Populate filter dropdowns
            populateFilters();
            
            // Display all options initially
            displayLoanOptions(allLoanOptions);
            updateResultCount(allLoanOptions.length);
            
            // Set initial sort state
            currentSortField = 'monthlyPayment';
            currentSortDirection = 'asc';
            updateSortIcons('monthlyPayment', 'asc');

            document.getElementById('loanTable').classList.remove('hidden');
        }

        // Global variables for filtering and sorting
        let allLoanOptions = [];
        let currentSortField = '';
        let currentSortDirection = 'asc';

        // Set default values
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('systemPower').value = '10.44';
            
            // Add event listeners for filters
            document.getElementById('bankFilter').addEventListener('change', applyFilters);
            document.getElementById('periodFilter').addEventListener('change', applyFilters);
            document.getElementById('sortBy').addEventListener('change', applySorting);
        });

        function populateFilters() {
            const bankFilter = document.getElementById('bankFilter');
            const periodFilter = document.getElementById('periodFilter');
            
            // Get unique banks and periods
            const banks = [...new Set(allLoanOptions.map(option => option.bankName))];
            const periods = [...new Set(allLoanOptions.map(option => option.loanPeriod))].sort((a, b) => a - b);
            
            // Clear existing options (except first)
            bankFilter.innerHTML = '<option value="">All Banks</option>';
            periodFilter.innerHTML = '<option value="">All Periods</option>';
            
            // Add bank options
            banks.forEach(bank => {
                const option = document.createElement('option');
                option.value = bank;
                option.textContent = bank;
                bankFilter.appendChild(option);
            });
            
            // Add period options
            periods.forEach(period => {
                const option = document.createElement('option');
                option.value = period;
                option.textContent = `${period} months`;
                periodFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            // Apply current sorting
            if (currentSortField) {
                filteredOptions = sortOptions(filteredOptions, currentSortField, currentSortDirection);
            }
            
            displayLoanOptions(filteredOptions);
            updateResultCount(filteredOptions.length);
        }

        function applySorting() {
            const sortBy = document.getElementById('sortBy').value;
            if (!sortBy) return;
            
            const [field, direction] = sortBy.includes('Desc') 
                ? [sortBy.replace('Desc', ''), 'desc'] 
                : [sortBy, 'asc'];
            
            currentSortField = field;
            currentSortDirection = direction;
            
            // Get current filtered options
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            filteredOptions = sortOptions(filteredOptions, field, direction);
            displayLoanOptions(filteredOptions);
        }

        function sortOptions(options, field, direction) {
            return options.sort((a, b) => {
                let aVal = a[field];
                let bVal = b[field];
                
                // Handle string comparison
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
        }

        function sortTable(field) {
            // Toggle direction if same field
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
            
            // Get current filtered options
            const bankFilter = document.getElementById('bankFilter').value;
            const periodFilter = document.getElementById('periodFilter').value;
            
            let filteredOptions = allLoanOptions.filter(option => {
                const bankMatch = !bankFilter || option.bankName === bankFilter;
                const periodMatch = !periodFilter || option.loanPeriod === parseInt(periodFilter);
                return bankMatch && periodMatch;
            });
            
            filteredOptions = sortOptions(filteredOptions, field, currentSortDirection);
            displayLoanOptions(filteredOptions);
            updateSortIcons(field, currentSortDirection);
        }

        function updateSortIcons(field, direction) {
            // Reset all icons
            const icons = ['bankSortIcon', 'periodSortIcon', 'rateSortIcon', 'commissionSortIcon', 
                          'amountSortIcon', 'paymentSortIcon', 'interestSortIcon', 'totalSortIcon'];
            icons.forEach(id => {
                document.getElementById(id).textContent = '↕';
            });
            
            // Set active icon
            const iconMap = {
                'bankName': 'bankSortIcon',
                'loanPeriod': 'periodSortIcon',
                'interestRate': 'rateSortIcon',
                'commission': 'commissionSortIcon',
                'loanAmount': 'amountSortIcon',
                'monthlyPayment': 'paymentSortIcon',
                'totalInterest': 'interestSortIcon',
                'totalAmount': 'totalSortIcon'
            };
            
            const activeIcon = document.getElementById(iconMap[field]);
            if (activeIcon) {
                activeIcon.textContent = direction === 'asc' ? '↑' : '↓';
            }
        }

        function clearFilters() {
            document.getElementById('bankFilter').value = '';
            document.getElementById('periodFilter').value = '';
            document.getElementById('sortBy').value = 'monthlyPayment';
            
            currentSortField = 'monthlyPayment';
            currentSortDirection = 'asc';
            
            // Reset sort icons
            updateSortIcons('monthlyPayment', 'asc');
            
            // Display all options sorted by monthly payment
            const sortedOptions = sortOptions([...allLoanOptions], 'monthlyPayment', 'asc');
            displayLoanOptions(sortedOptions);
            updateResultCount(sortedOptions.length);
        }

        function updateResultCount(count) {
            const totalCount = allLoanOptions.length;
            document.getElementById('resultCount').textContent = 
                count === totalCount ? `Showing all ${totalCount} results` : `Showing ${count} of ${totalCount} results`;
        }

        function displayLoanOptions(options) {
            const tableBody = document.getElementById('loanTableBody');
            tableBody.innerHTML = '';

            options.forEach(option => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="border p-3 font-medium">${option.bankName}</td>
                    <td class="border p-3 text-center w-32">${option.loanPeriod} months</td>
                    <td class="border p-3 text-center w-24">${(option.interestRate * 100).toFixed(1)}%</td>
                    <td class="border p-3 text-center w-28">${(option.commission * 100).toFixed(2)}%</td>
                    <td class="border p-3 text-center font-semibold text-green-600 w-40">${option.loanAmount.toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-blue-600 w-36">${option.monthlyPayment.toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-red-600 w-40">${Math.abs(option.totalInterest).toLocaleString()}</td>
                    <td class="border p-3 text-center font-semibold text-purple-600 w-44">${option.totalAmount.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }
    </script>
</body>
</html> 