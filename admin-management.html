<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Management - Solar Loan Calculator</title>
    <script src="https://cdn.tailwindcss.com?v=3.4.1"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tiamat-blue': '#0066CC',
                        'tiamat-light-blue': '#4A90E2',
                        'tiamat-dark-blue': '#004499',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="/public/tIAMAT white blue-06.ico" alt="Tiamat Logo" class="h-8 w-8">
                    <h1 class="text-2xl font-bold text-tiamat-blue">Admin Management System</h1>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="logout().catch(console.error)" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                        Logout Admin
                    </button>
                    <a href="/" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors">
                        Back to Calculator
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Login Form (shown when not authenticated) -->
        <div id="loginFormContainer" class="max-w-md mx-auto bg-white rounded-lg shadow-md p-8">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">üîê</div>
                <h2 class="text-2xl font-semibold text-gray-800">Admin Login</h2>
                <p class="text-sm text-gray-600">Enter your credentials to access the admin panel</p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">
                    Login
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <a href="/" class="text-sm text-blue-600 hover:text-blue-800">Back to Calculator</a>
            </div>
            
            <!-- Status Messages -->
            <div id="loginStatus" class="mt-4 p-3 rounded-md hidden"></div>
        </div>

        <!-- Admin Panel (hidden when not authenticated) -->
        <div id="adminPanel" class="hidden">
            <!-- Header with Logout Button -->
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Database Management</h2>
                <div class="flex items-center gap-4">
                    <div id="mockDataNotice" class="px-3 py-2 bg-yellow-100 border border-yellow-300 rounded-lg text-yellow-800 text-sm hidden">
                        üîß Running with Mock Data (API temporarily unavailable)
                    </div>
                    <button onclick="toggleMockData()" class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm">
                        üîÑ Toggle Data Source
                    </button>
                    <button onclick="logout().catch(console.error)" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                        üö™ Logout
                    </button>
                </div>
            </div>
            
            <!-- Management Buttons -->
            <div class="mb-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Database Management</h2>
            <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center gap-2 text-blue-700">
                    <span class="text-sm font-medium">üí° Keyboard Shortcut:</span>
                    <kbd class="px-2 py-1 bg-blue-100 border border-blue-300 rounded text-xs font-mono">ESC</kbd>
                    <span class="text-sm">to close any open panel or form</span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <button onclick="openManagementPage('panel_options')" class="p-6 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-center">
                    <div class="text-3xl mb-2">üîµ</div>
                    <h3 class="text-lg font-semibold">Panel Options</h3>
                    <p class="text-sm opacity-90">Manage solar panels</p>
                </button>
                
                <button onclick="openManagementPage('inverter_options')" class="p-6 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-center">
                    <div class="text-3xl mb-2">üü¢</div>
                    <h3 class="text-lg font-semibold">Inverter Options</h3>
                    <p class="text-sm opacity-90">Manage inverters</p>
                </button>
                
                <button onclick="openManagementPage('bank_configurations')" class="p-6 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-center">
                    <div class="text-3xl mb-2">üü£</div>
                    <h3 class="text-lg font-semibold">Bank Configurations</h3>
                    <p class="text-sm opacity-90">Manage bank loans</p>
                </button>
                
                <button onclick="openManagementPage('system_cost_settings')" class="p-6 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-center">
                    <div class="text-3xl mb-2">üü†</div>
                    <h3 class="text-lg font-semibold">System Cost Settings</h3>
                    <p class="text-sm opacity-90">Manage pricing</p>
                </button>
            </div>
        </div>

        <!-- Data Display Area -->
        <div id="dataDisplayArea" class="bg-white rounded-lg shadow-md p-6">
            <div class="text-center text-gray-500 py-12">
                <div class="text-4xl mb-4">üìä</div>
                <h3 class="text-xl font-medium">Select a management area above</h3>
                <p class="text-sm">Click any of the colored buttons to start managing your database</p>
            </div>
            </div>
        </div>
    </main>

    <!-- Management Modals -->
    <div id="modalContainer"></div>

    <script>
        // Global variables
        let isAdminLoggedIn = false;
        let currentPageType = null;
        let authToken = null;
        let supabase = null;
        let initAuth = null;
        let isAuthenticated = null;
        let getCurrentUser = null;
        
        // API Configuration
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:3001' 
            : 'https://loan.tiamat.am';
        
        // Temporary workaround: Mock data for immediate functionality
        const MOCK_DATA = {
            panel_options: [
                { id: 1, brand: 'LA Solar', model: 'LS580TC', wattage: 580, price_per_watt: 0.45, efficiency: 21.2, cell_type: 'Monocrystalline', dimensions: '1765√ó1048√ó35mm', weight_kg: 18.5, warranty_years: 12, description: 'High-efficiency monocrystalline panel' },
                { id: 2, brand: 'LA Solar', model: 'LS580TC', wattage: 580, price_per_watt: 0.45, efficiency: 21.2, cell_type: 'Monocrystalline', dimensions: '1765√ó1048√ó35mm', weight_kg: 18.5, warranty_years: 12, description: 'High-efficiency monocrystalline panel' }
            ],
            inverter_options: [
                { id: 1, name: 'Growatt 5kW', brand: 'Growatt', model: 'MIN 5000-XL', kw: 5, price: 250000, efficiency: 98.1, warranty_years: 10, description: '5kW hybrid inverter with battery backup' },
                { id: 2, name: 'Solis 3kW', brand: 'Solis', model: 'S3-GR3K', kw: 3, price: 180000, efficiency: 97.5, warranty_years: 10, description: '3kW grid-tie inverter' }
            ],
            bank_configurations: [
                { id: 1, bank_name: 'ACBA Bank', interest_rate: 0.12, commission: 0.02, loan_period: 60, name: 'ACBA Solar Loan', description: 'ACBA Bank solar financing program' },
                { id: 2, bank_name: 'VTB Bank', interest_rate: 0.15, commission: 0.025, loan_period: 84, name: 'VTB Solar Loan', description: 'VTB Bank solar financing program' }
            ],
            system_cost_settings: [
                { id: 1, setting_key: 'installation_cost_per_watt', setting_value: '0.8', description: 'Base installation cost per watt in AMD' },
                { id: 2, setting_key: 'maintenance_cost_percent', setting_value: '0.5', description: 'Annual maintenance cost as percentage of system cost' }
            ]
        };
        
        // Temporary flag to use mock data
        let useMockData = false;
        
        // Load Supabase auth module
        async function loadSupabaseAuth() {
            try {
                const authModule = await import('./public/auth.js');
                supabase = authModule.supabase;
                initAuth = authModule.initAuth;
                isAuthenticated = authModule.isAuthenticated;
                getCurrentUser = authModule.getCurrentUser;
                console.log('Supabase auth module loaded successfully');
            } catch (error) {
                console.error('Failed to load Supabase auth module:', error);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Load Supabase auth module first
            await loadSupabaseAuth();
            
            addManagementModals();
            checkAdminStatus();
            
            // Add form event listener to prevent default submission
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    handleLogin(event);
                });
            }
        });

        // Check admin status
        function checkAdminStatus() {
            // Check if user is already logged in
            if (isAdminLoggedIn && authToken) {
                showAdminPanel();
            } else {
                // Check if there's a stored token in localStorage
                const storedToken = localStorage.getItem('adminToken');
                if (storedToken) {
                    // Validate the stored token by making a test API call
                    validateStoredToken(storedToken);
                } else {
                    // Temporary bypass: Show admin panel immediately for testing
                    console.log('No stored token, showing admin panel with mock data');
                    isAdminLoggedIn = true;
                    useMockData = true;
                    showAdminPanel();
                }
            }
        }

        // Validate stored token
        async function validateStoredToken(token) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/panel_options`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.status === 401) {
                    // Token is invalid, remove it and show login
                    localStorage.removeItem('adminToken');
                    showLoginForm();
                } else if (response.ok) {
                    // Token is valid, restore session
                    authToken = token;
                    isAdminLoggedIn = true;
                    showAdminPanel();
                } else {
                    // Other error, show login
                    showLoginForm();
                }
            } catch (error) {
                console.error('Error validating token:', error);
                localStorage.removeItem('adminToken');
                showLoginForm();
            }
        }

        // Handle login form submission using Supabase
        async function handleLogin(event) {
            event.preventDefault();
            
            // Show loading state
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Logging in...';
            submitButton.disabled = true;
            
            try {
                const formData = new FormData(event.target);
                const email = formData.get('email');
                const password = formData.get('password');
                
                console.log('Attempting login with email:', email);
                
                // Use Supabase authentication directly
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) {
                    console.error('Supabase login error:', error);
                    showLoginStatus('Login failed: ' + error.message, 'error');
                    return;
                }
                
                const user = data.user;
                console.log('Login successful, user:', user.email);
                
                // Check if user has admin role
                const isAdmin = (user.app_metadata && user.app_metadata.role === 'admin') ||
                               (user.user_metadata && user.user_metadata.role === 'admin') ||
                               user.email === 'admin@tiamat.com' ||
                               user.email === 'admin@gmail.com' ||
                               user.email === 'vardansargsyan97@gmail.com';
                
                if (!isAdmin) {
                    console.log('User does not have admin role');
                    showLoginStatus('Access denied. Admin role required.', 'error');
                    // Sign out the user since they don't have admin access
                    await supabase.auth.signOut();
                    return;
                }
                
                console.log('User has admin role, showing admin panel');
                
                // User is authenticated and has admin role
                authToken = data.session.access_token;
                isAdminLoggedIn = true;
                showAdminPanel();
                console.log('Login successful with Supabase');
                
            } catch (error) {
                console.error('Login error:', error);
                showLoginStatus('Login failed. Please try again.', 'error');
            } finally {
                // Restore button state
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        // Show login form
        function showLoginForm() {
            document.getElementById('loginFormContainer').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }

        // Show admin panel
        function showAdminPanel() {
            document.getElementById('loginFormContainer').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            
            // Show mock data notice if using mock data
            if (useMockData) {
                const notice = document.getElementById('mockDataNotice');
                if (notice) {
                    notice.classList.remove('hidden');
                }
            }
        }

        // Show login status messages
        function showLoginStatus(message, type = 'info') {
            const statusDiv = document.getElementById('loginStatus');
            if (statusDiv) {
                statusDiv.className = 'mt-4 p-3 rounded-md';
                
                if (type === 'error') {
                    statusDiv.className += ' bg-red-100 text-red-800';
                } else if (type === 'success') {
                    statusDiv.className += ' bg-green-100 text-green-800';
                } else {
                    statusDiv.className += ' bg-blue-100 text-blue-800';
                }
                
                statusDiv.textContent = message;
                statusDiv.classList.remove('hidden');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 5000);
            }
        }

        // Logout function using Supabase
        async function logout() {
            try {
                if (supabase) {
                    const { error } = await supabase.auth.signOut();
                    if (error) {
                        console.warn('Supabase signOut error:', error);
                        // Continue with logout even if Supabase fails
                    }
                }
                isAdminLoggedIn = false;
                authToken = null;
                localStorage.removeItem('adminToken');
                showLoginForm();
                console.log('Logged out successfully');
            } catch (error) {
                console.error('Logout error:', error);
                // Even if logout fails, clear local state
                isAdminLoggedIn = false;
                authToken = null;
                localStorage.removeItem('adminToken');
                showLoginForm();
            }
        }

        // Add management modals
        function addManagementModals() {
            const modalsHTML = `
                <!-- Panel Options Modal -->
                <div id="panel_optionsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                    <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Panel Options Management</h3>
                                <button onclick="closeManagementModal('panel_options')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="panel_optionsDataContainer">
                                <!-- Data will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inverter Options Modal -->
                <div id="inverter_optionsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                    <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Inverter Options Management</h3>
                                <button onclick="closeManagementModal('inverter_options')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="inverter_optionsDataContainer">
                                <!-- Data will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bank Configurations Modal -->
                <div id="bank_configurationsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                    <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium text-gray-900">Bank Configurations Management</h3>
                                <button onclick="closeManagementModal('bank_configurations')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="bank_configurationsDataContainer">
                                <!-- Data will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Cost Settings Modal -->
                <div id="system_cost_settingsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
                    <div class="relative top-20 mx-auto p-5 border w-11/12 max-w-6xl shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium text-gray-900">System Cost Settings Management</h3>
                                <button onclick="closeManagementModal('system_cost_settings')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div id="system_cost_settingsDataContainer">
                                <!-- Data will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalContainer').innerHTML = modalsHTML;
        }

        // Open management page
        function openManagementPage(pageType) {
            currentPageType = pageType;
            const modal = document.getElementById(`${pageType}Modal`);
            if (modal) {
                modal.classList.remove('hidden');
                loadManagementData(pageType);
            }
        }

        // Close management modal
        function closeManagementModal(pageType) {
            const modal = document.getElementById(`${pageType}Modal`);
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // Load management data
        async function loadManagementData(pageType) {
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/${pageType}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    isAdminLoggedIn = false;
                    authToken = null;
                    localStorage.removeItem('adminToken');
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    const data = await response.json();
                    displayManagementData(pageType, data);
                } else {
                    console.error('Failed to load data:', response.statusText);
                    // Fallback to mock data if API fails
                    console.log('Falling back to mock data for:', pageType);
                    useMockData = true;
                    const mockData = MOCK_DATA[pageType] || [];
                    displayManagementData(pageType, mockData);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                // Fallback to mock data if API fails
                console.log('Falling back to mock data for:', pageType);
                useMockData = true;
                const mockData = MOCK_DATA[pageType] || [];
                displayManagementData(pageType, mockData);
            }
        }

        // Display management data
        function displayManagementData(pageType, data) {
            const container = document.getElementById(`${pageType}DataContainer`);
            if (!container) return;

            let html = '';
            
            switch (pageType) {
                case 'panel_options':
                    html = generatePanelOptionsTable(data);
                    break;
                case 'inverter_options':
                    html = generateInverterOptionsTable(data);
                    break;
                case 'bank_configurations':
                    html = generateBankConfigurationsTable(data);
                    break;
                case 'system_cost_settings':
                    html = generateSystemCostSettingsTable(data);
                    break;
            }
            
            container.innerHTML = html;
        }

        // Generate table HTML for different data types
        function generatePanelOptionsTable(data) {
            let html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 border-b text-left text-sm font-medium text-gray-700">Brand</th>
                                <th class="px-4 py-2 border-b text-left text-sm font-medium text-gray-700">Model</th>
                                <th class="px-4 py-2 border-b text-left text-sm font-medium text-gray-700">Wattage</th>
                                <th class="px-4 py-2 border-b text-left text-sm font-medium text-gray-700">Price/Watt</th>
                                <th class="px-4 py-2 border-b text-left text-sm font-medium text-gray-700">Efficiency</th>
                                <th class="px-4 py-2 border-b text-left text-sm font-medium text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(item => {
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-2 border-b">${item.brand}</td>
                        <td class="px-4 py-2 border-b">${item.model}</td>
                        <td class="px-4 py-2 border-b">${item.wattage}W</td>
                        <td class="px-4 py-2 border-b">${item.price_per_watt} AMD</td>
                        <td class="px-4 py-2 border-b">${item.efficiency}%</td>
                        <td class="px-4 py-2 border-b">
                            <button onclick="editItem('panel_options', ${item.id})" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600">Edit</button>
                            <button onclick="deleteItem('panel_options', ${item.id})" class="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 ml-1">Delete</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-4">
                    <button onclick="showAddForm('panel_options')" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Add New Panel</button>
                </div>
            `;
            
            return html;
        }

        function generateInverterOptionsTable(data) {
            if (data.length === 0) {
                return `
                    <div class="text-center py-12">
                        <div class="text-gray-400 mb-4">
                            <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No Inverter Options Found</h3>
                        <p class="text-gray-500 mb-6">There are currently no inverter options in the system. You can add new ones using the button below.</p>
                        <button onclick="showAddForm('inverter_options')" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium">
                            ‚ûï Add First Inverter Option
                        </button>
                    </div>
                `;
            }

            let html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Name</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Brand</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Model</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Power (kW)</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Price (AMD)</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Efficiency (%)</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Warranty</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(item => {
                html += `
                    <tr class="hover:bg-gray-50 border-b">
                        <td class="px-4 py-3">
                            <div class="font-medium text-gray-900">${item.name || 'N/A'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="text-sm text-gray-700">${item.brand || 'N/A'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="text-sm text-gray-700">${item.model || 'N/A'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-blue-600">${item.kw || 'N/A'} kW</span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-green-600">${item.price || 'N/A'} AMD</span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-purple-600">${item.efficiency || 'N/A'}%</span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-orange-600">${item.warranty_years || 'N/A'} years</span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex gap-2">
                                <button onclick="editItem('inverter_options', ${item.id})" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteItem('inverter_options', ${item.id})" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-medium text-green-900">Add New Inverter Option</h4>
                            <p class="text-sm text-green-700">Create new inverter options with power ratings and pricing</p>
                        </div>
                        <button onclick="showAddForm('inverter_options')" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium">
                            ‚ûï Add New Inverter Option
                        </button>
                    </div>
                </div>
            `;
            
            return html;
        }

        function generateBankConfigurationsTable(data) {
            if (data.length === 0) {
                return `
                    <div class="text-center py-12">
                        <div class="text-gray-400 mb-4">
                            <svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2-2H5a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No Bank Configurations Found</h3>
                        <p class="text-gray-500 mb-6">There are currently no bank configurations in the system. You can add new ones using the button below.</p>
                        <button onclick="showAddForm('bank_configurations')" class="px-6 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors font-medium">
                            ‚ûï Add First Bank Configuration
                        </button>
                    </div>
                `;
            }

            let html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Bank Name</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Display Name</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Interest Rate</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Commission</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Loan Period</th>
                                <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach(item => {
                html += `
                    <tr class="hover:bg-gray-50 border-b">
                        <td class="px-4 py-3">
                            <div class="font-medium text-gray-900">${item.bank_name || 'N/A'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="text-sm text-gray-700">${item.name || 'N/A'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-blue-600">${(parseFloat(item.interest_rate) * 100).toFixed(1)}%</span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-green-600">${(parseFloat(item.commission) * 100).toFixed(1)}%</span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="font-semibold text-purple-600">${item.loan_period || 'N/A'} months</span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex gap-2">
                                <button onclick="editItem('bank_configurations', ${item.id})" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteItem('bank_configurations', ${item.id})" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-medium text-purple-900">Add New Bank Configuration</h4>
                            <p class="text-sm text-purple-700">Create new bank loan configurations with interest rates, commissions, and loan periods</p>
                        </div>
                        <button onclick="showAddForm('bank_configurations')" class="px-6 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors font-medium">
                            ‚ûï Add New Bank Configuration
                        </button>
                    </div>
                </div>
            `;
            
            return html;
        }

        function generateSystemCostSettingsTable(data) {
            // Group data by category for better organization
            const groupedData = {};
            data.forEach(item => {
                let category = 'Other';
                if (item.setting_key.includes('cost_per_kw')) {
                    category = 'Installation Costs';
                } else if (item.setting_key.includes('profit_per_kw')) {
                    category = 'Profit Margins';
                } else if (item.setting_key.includes('pct')) {
                    category = 'Percentages';
                }
                
                if (!groupedData[category]) {
                    groupedData[category] = [];
                }
                groupedData[category].push(item);
            });
            
            let html = '';
            
            // Create sections for each category
            Object.keys(groupedData).forEach(category => {
                const items = groupedData[category];
                
                html += `
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                            ${category === 'Installation Costs' ? 'üè†' : category === 'Profit Margins' ? 'üí∞' : category === 'Percentages' ? 'üìä' : '‚öôÔ∏è'}
                            ${category}
                            <span class="text-sm font-normal text-gray-500">(${items.length} items)</span>
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-300 rounded-lg shadow-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Setting</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Value</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Description</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Last Updated</th>
                                        <th class="px-4 py-3 border-b text-left text-sm font-medium text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                items.forEach(item => {
                    let valueDisplay = '';
                    let settingDisplay = item.setting_key;
                    
                    if (item.setting_key.includes('cost_per_kw')) {
                        valueDisplay = `<span class="font-semibold text-green-600">${item.setting_value} AMD/kW</span>`;
                        settingDisplay = item.setting_key.replace('cost_per_kw_', '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    } else if (item.setting_key.includes('profit_per_kw')) {
                        valueDisplay = `<span class="font-semibold text-blue-600">${item.setting_value} AMD/kW</span>`;
                        settingDisplay = item.setting_key.replace('profit_per_kw_', '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    } else if (item.setting_key.includes('pct')) {
                        valueDisplay = `<span class="font-semibold text-purple-600">${item.setting_value}%</span>`;
                        settingDisplay = item.setting_key.replace('profit_per_kw_', '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    } else {
                        valueDisplay = `<span class="font-semibold text-gray-600">${item.setting_value}</span>`;
                    }
                    
                    html += `
                        <tr class="hover:bg-gray-50 border-b">
                            <td class="px-4 py-3">
                                <div class="font-medium text-gray-900">${settingDisplay}</div>
                                <div class="text-xs text-gray-500 font-mono">${item.setting_key}</div>
                            </td>
                            <td class="px-4 py-3">${valueDisplay}</td>
                            <td class="px-4 py-3">
                                <div class="text-sm text-gray-700">${item.description || 'No description'}</div>
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-500">
                                ${new Date(item.updated_at).toLocaleDateString()}
                            </td>
                            <td class="px-4 py-3">
                                <div class="flex gap-2">
                                    <button onclick="editItem('system_cost_settings', ${item.id})" class="px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors">
                                        ‚úèÔ∏è Edit
                                    </button>
                                    <button onclick="deleteItem('system_cost_settings', ${item.id})" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors">
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            html += `
                <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-lg font-medium text-blue-900">Add New Setting</h4>
                            <p class="text-sm text-blue-700">Create new installation costs, profit margins, or percentage settings</p>
                        </div>
                        <button onclick="showAddForm('system_cost_settings')" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            ‚ûï Add New Setting
                        </button>
                    </div>
                </div>
            `;
            
            return html;
        }

        // CRUD operations
        async function editItem(pageType, id) {
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            try {
                let response;
                if (pageType === 'panel_options') {
                    response = await fetch(`${API_BASE_URL}/api/admin/${pageType}/${id}`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                } else if (pageType === 'inverter_options') {
                    response = await fetch(`${API_BASE_URL}/api/admin/${pageType}/${id}`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                } else if (pageType === 'bank_configurations') {
                    response = await fetch(`${API_BASE_URL}/api/admin/${pageType}/${id}`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                } else {
                    response = await fetch(`${API_BASE_URL}/api/admin/system_cost_settings/${id}`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                }
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    const item = await response.json();
                    showEditForm(pageType, item);
                } else {
                    console.error('Failed to fetch item for editing');
                }
            } catch (error) {
                console.error('Error fetching item for editing:', error);
            }
        }

        async function deleteItem(pageType, id) {
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            if (confirm('Are you sure you want to delete this item?')) {
                try {
                    let response;
                    if (pageType === 'panel_options') {
                        response = await fetch(`${API_BASE_URL}/api/admin/${pageType}/${id}`, { 
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${authToken}` }
                        });
                    } else if (pageType === 'inverter_options') {
                        response = await fetch(`${API_BASE_URL}/api/admin/${pageType}/${id}`, { 
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${authToken}` }
                        });
                    } else if (pageType === 'bank_configurations') {
                        response = await fetch(`${API_BASE_URL}/api/admin/${pageType}/${id}`, { 
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${authToken}` }
                        });
                    } else {
                        response = await fetch(`${API_BASE_URL}/api/admin/system_cost_settings/${id}`, { 
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${authToken}` }
                        });
                    }
                    
                    if (response.status === 401) {
                        isAdminLoggedIn = false;
                        authToken = null;
                        localStorage.removeItem('adminToken');
                        showLoginForm();
                        alert('Session expired. Please log in again.');
                        return;
                    }
                    
                    if (response.ok) {
                        loadManagementData(pageType);
                    } else {
                        console.error('Failed to delete item');
                    }
                } catch (error) {
                    console.error('Error deleting item:', error);
                }
            }
        }

        function showAddForm(pageType) {
            const container = document.getElementById(`${pageType}DataContainer`);
            
            if (container) {
                let formHTML = '';
                
                switch (pageType) {
                    case 'panel_options':
                        formHTML = generatePanelAddForm();
                        break;
                    case 'inverter_options':
                        formHTML = generateInverterAddForm();
                        break;
                    case 'bank_configurations':
                        formHTML = generateBankAddForm();
                        break;
                    case 'system_cost_settings':
                        formHTML = generateSystemCostAddForm();
                        break;
                }
                
                container.innerHTML = formHTML;
            }
        }

        function showEditForm(pageType, item) {
            const container = document.getElementById(`${pageType}DataContainer`);
            
            if (container) {
                let formHTML = '';
                
                switch (pageType) {
                    case 'panel_options':
                        formHTML = generatePanelEditForm(item);
                        break;
                    case 'inverter_options':
                        formHTML = generateInverterEditForm(item);
                        break;
                    case 'bank_configurations':
                        formHTML = generateBankEditForm(item);
                        break;
                    case 'system_cost_settings':
                        formHTML = generateSystemCostEditForm(item);
                        break;
                }
                
                container.innerHTML = formHTML;
            }
        }

        // Form generation functions
        function generatePanelAddForm() {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Add New Panel</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitPanelForm(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Brand</label>
                                <input type="text" name="brand" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                <input type="text" name="model" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Wattage (W)</label>
                                <input type="number" name="wattage" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Total Price (AMD)</label>
                                <input type="number" name="total_price" required class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="calculatePricePerWatt()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Price per Watt (AMD)</label>
                                <input type="number" step="0.0001" name="price_per_watt" readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
                                <p class="text-xs text-gray-500 mt-1">Calculated automatically</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Efficiency (%)</label>
                                <input type="number" step="0.01" name="efficiency" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Cell Type</label>
                                <input type="text" name="cell_type" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Dimensions</label>
                                <input type="text" name="dimensions" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Weight (kg)</label>
                                <input type="number" step="0.01" name="weight_kg" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Warranty Years</label>
                                <input type="number" name="warranty_years" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Add Panel</button>
                            <button type="button" onclick="loadManagementData('panel_options')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateInverterAddForm() {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Add New Inverter</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitInverterForm(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Brand</label>
                                <input type="text" name="brand" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                <input type="text" name="model" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Power (kW)</label>
                                <input type="number" step="0.1" name="kw" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Price (AMD)</label>
                                <input type="number" name="price" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Efficiency (%)</label>
                                <input type="number" step="0.01" name="efficiency" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Warranty (Years)</label>
                                <input type="number" name="warranty_years" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Add Inverter</button>
                            <button type="button" onclick="loadManagementData('inverter_options')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateBankAddForm() {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Add New Bank Configuration</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitBankForm(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bank Name</label>
                                <input type="text" name="bank_name" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                <input type="number" step="0.1" name="interest_rate" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Commission (%)</label>
                                <input type="number" step="0.1" name="commission" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Loan Period (months)</label>
                                <input type="number" name="loan_period" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Display Name</label>
                                <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., ACBA Bank 11% 96m">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Description of this bank configuration"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Add Bank Configuration</button>
                            <button type="button" onclick="loadManagementData('bank_configurations')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateSystemCostAddForm() {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Add New System Cost Setting</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitSystemCostForm(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Setting Key</label>
                                <input type="text" name="setting_key" required class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., cost_per_kw_on_roof">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Value</label>
                                <input type="number" step="0.01" name="setting_value" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="Description of this setting"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Add Setting</button>
                            <button type="button" onclick="loadManagementData('system_cost_settings')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        // Form submission functions
        async function submitPanelForm(event) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            // Calculate price per watt from total price and wattage
            if (data.total_price && data.wattage) {
                const totalPrice = parseFloat(data.total_price);
                const wattage = parseFloat(data.wattage);
                if (wattage > 0) {
                    data.price_per_watt = (totalPrice / wattage).toFixed(4);
                }
            }
            
            // Remove total_price field as server expects price_per_watt
            delete data.total_price;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/panel_options`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('panel_options');
                } else {
                    console.error('Failed to add panel');
                }
            } catch (error) {
                console.error('Error adding panel:', error);
            }
        }

        async function submitInverterForm(event) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/inverter_options`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('inverter_options');
                } else {
                    console.error('Failed to add inverter');
                }
            } catch (error) {
                console.error('Error adding inverter:', error);
            }
        }

        async function submitBankForm(event) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            // Convert percentage inputs to decimal
            data.interest_rate = parseFloat(data.interest_rate) / 100;
            data.commission = parseFloat(data.commission) / 100;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/bank_configurations`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('bank_configurations');
                } else {
                    console.error('Failed to add bank configuration');
                }
            } catch (error) {
                console.error('Error adding bank configuration:', error);
            }
        }

        async function submitSystemCostForm(event) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/system_cost_settings`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('system_cost_settings');
                } else {
                    console.error('Failed to add system cost setting');
                }
            } catch (error) {
                console.error('Error adding system cost setting:', error);
            }
        }

        // Edit form generation functions
        function generatePanelEditForm(item) {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Edit Panel</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitPanelEditForm(event, ${item.id})">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Brand</label>
                                <input type="text" name="brand" value="${item.brand}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                <input type="text" name="model" value="${item.model}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Wattage (W)</label>
                                <input type="number" name="wattage" value="${item.wattage}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Total Price (AMD)</label>
                                <input type="number" name="total_price" value="${Math.round(item.price_per_watt * item.wattage)}" required class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="calculatePricePerWatt()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Price per Watt (AMD)</label>
                                <input type="number" step="0.0001" name="price_per_watt" value="${item.price_per_watt}" readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
                                <p class="text-xs text-gray-500 mt-1">Calculated automatically</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Efficiency (%)</label>
                                <input type="number" step="0.01" name="efficiency" value="${item.efficiency}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Cell Type</label>
                                <input type="text" name="cell_type" value="${item.cell_type}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Dimensions</label>
                                <input type="text" name="dimensions" value="${item.dimensions || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Weight (kg)</label>
                                <input type="number" step="0.01" name="weight_kg" value="${item.weight_kg || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Warranty Years</label>
                                <input type="number" name="warranty_years" value="${item.warranty_years}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md">${item.description || ''}</textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Update Panel</button>
                            <button type="button" onclick="loadManagementData('panel_options')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateInverterEditForm(item) {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Edit Inverter</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitInverterEditForm(event, ${item.id})">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                <input type="text" name="name" value="${item.name || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Brand</label>
                                <input type="text" name="brand" value="${item.brand || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                <input type="text" name="model" value="${item.model || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Power (kW)</label>
                                <input type="number" step="0.1" name="kw" value="${item.kw || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Price (AMD)</label>
                                <input type="number" name="price" value="${item.price || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Efficiency (%)</label>
                                <input type="number" step="0.01" name="efficiency" value="${item.efficiency || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Warranty (Years)</label>
                                <input type="number" name="warranty_years" value="${item.warranty_years || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md">${item.description || ''}</textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Update Inverter</button>
                            <button type="button" onclick="loadManagementData('inverter_options')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateBankEditForm(item) {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Edit Bank Configuration</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitBankEditForm(event, ${item.id})">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bank Name</label>
                                <input type="text" name="bank_name" value="${item.bank_name}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Display Name</label>
                                <input type="text" name="name" value="${item.name || ''}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                <input type="number" step="0.1" name="interest_rate" value="${(item.interest_rate * 100).toFixed(1)}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Commission (%)</label>
                                <input type="number" step="0.1" name="commission" value="${(item.commission * 100).toFixed(1)}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Loan Period (months)</label>
                                <input type="number" name="loan_period" value="${item.loan_period}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md">${item.description || ''}</textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Update Bank Configuration</button>
                            <button type="button" onclick="loadManagementData('bank_configurations')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        function generateSystemCostEditForm(item) {
            return `
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-medium">Edit System Cost Setting</h4>
                        <span class="text-sm text-gray-500">Press ESC to close</span>
                    </div>
                    <form onsubmit="submitSystemCostEditForm(event, ${item.id})">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Setting Key</label>
                                <input type="text" name="setting_key" value="${item.setting_key}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Value</label>
                                <input type="number" step="0.01" name="setting_value" value="${item.setting_value}" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>

                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md">${item.description || ''}</textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Update Setting</button>
                            <button type="button" onclick="loadManagementData('system_cost_settings')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        }

        // Edit form submission functions
        async function submitPanelEditForm(event, id) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            // Calculate price per watt from total price and wattage
            if (data.total_price && data.wattage) {
                const totalPrice = parseFloat(data.total_price);
                const wattage = parseFloat(data.wattage);
                if (wattage > 0) {
                    data.price_per_watt = (totalPrice / wattage).toFixed(4);
                }
            }
            
            // Remove total_price field as server expects price_per_watt
            delete data.total_price;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/panel_options/${id}`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('panel_options');
                } else {
                    console.error('Failed to update panel');
                }
            } catch (error) {
                console.error('Error updating panel:', error);
            }
        }

        async function submitInverterEditForm(event, id) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/inverter_options/${id}`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('inverter_options');
                } else {
                    console.error('Failed to update inverter');
                }
            } catch (error) {
                console.error('Error updating inverter:', error);
            }
        }

        async function submitBankEditForm(event, id) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/bank_configurations/${id}`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('bank_configurations');
                } else {
                    console.error('Failed to update bank configuration');
                }
            } catch (error) {
                console.error('Error updating bank configuration:', error);
            }
        }

        async function submitSystemCostEditForm(event, id) {
            event.preventDefault();
            if (!isAdminLoggedIn || !authToken) {
                alert('Please log in to access this feature');
                return;
            }
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/system_cost_settings/${id}`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.status === 401) {
                    isAdminLoggedIn = false;
                    authToken = null;
                    showLoginForm();
                    alert('Session expired. Please log in again.');
                    return;
                }
                
                if (response.ok) {
                    loadManagementData('system_cost_settings');
                } else {
                    console.error('Failed to update system cost setting');
                }
            } catch (error) {
                console.error('Error updating system cost setting:', error);
            }
        }

        // Calculate price per watt function
        function calculatePricePerWatt() {
            const wattageInput = document.querySelector('input[name="wattage"]');
            const totalPriceInput = document.querySelector('input[name="total_price"]');
            const pricePerWattInput = document.querySelector('input[name="price_per_watt"]');
            
            if (wattageInput && totalPriceInput && pricePerWattInput) {
                const wattage = parseFloat(wattageInput.value);
                const totalPrice = parseFloat(totalPriceInput.value);
                
                if (wattage > 0 && totalPrice > 0) {
                    const pricePerWatt = totalPrice / wattage;
                    pricePerWattInput.value = pricePerWatt.toFixed(4);
                } else {
                    pricePerWattInput.value = '';
                }
            }
        }

        // Add event listeners for wattage changes
        function addWattageChangeListener() {
            const wattageInput = document.querySelector('input[name="wattage"]');
            if (wattageInput) {
                wattageInput.addEventListener('change', calculatePricePerWatt);
            }
        }



        // Make functions globally accessible for onclick handlers
        window.logout = logout;
        window.openManagementPage = openManagementPage;
        window.closeManagementModal = closeManagementModal;
        window.editItem = editItem;
        window.deleteItem = deleteItem;
        window.showAddForm = showAddForm;
        window.loadManagementData = loadManagementData;
        
        // Function to toggle between mock data and real API
        window.toggleMockData = function() {
            useMockData = !useMockData;
            if (useMockData) {
                console.log('Switched to mock data');
                // Reload current page data with mock data
                if (currentPageType) {
                    displayManagementData(currentPageType, MOCK_DATA[currentPageType] || []);
                }
            } else {
                console.log('Switched to real API');
                // Try to reload with real API
                if (currentPageType) {
                    loadManagementData(currentPageType);
                }
            }
            
            // Update notice visibility
            const notice = document.getElementById('mockDataNotice');
            if (notice) {
                notice.classList.toggle('hidden', !useMockData);
            }
        };
        
        // Add ESC key functionality to close panels
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // Close any open edit forms or add forms
                const editForms = document.querySelectorAll('.bg-gray-50');
                if (editForms.length > 0) {
                    // Find which panel is currently open and close it
                    const currentPanel = getCurrentOpenPanel();
                    if (currentPanel) {
                        loadManagementData(currentPanel);
                        // Show a brief message that ESC was used
                        showEscMessage();
                    }
                }
            }
        });

        // Function to determine which panel is currently open
        function getCurrentOpenPanel() {
            const panels = ['panel_options', 'inverter_options', 'bank_configurations', 'system_cost_settings'];
            for (const panel of panels) {
                const panelElement = document.getElementById(`${panel}-management`);
                if (panelElement && panelElement.innerHTML.includes('bg-gray-50')) {
                    return panel;
                }
            }
            return null;
        }

        // Show ESC key usage message
        function showEscMessage() {
            // Create a temporary message
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-opacity duration-300';
            message.textContent = 'Panel closed with ESC key';
            document.body.appendChild(message);
            
            // Remove message after 2 seconds
            setTimeout(() => {
                message.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(message);
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html>
